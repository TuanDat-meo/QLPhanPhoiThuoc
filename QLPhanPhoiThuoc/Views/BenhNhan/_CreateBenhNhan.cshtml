@model QLPhanPhoiThuoc.Models.Entities.BenhNhan

<div class="card border-0 shadow-sm animate-fadeIn">
    <div class="card-body p-4">
        <h5 class="text-primary fw-bold mb-4"><i class="fas fa-user-plus me-2"></i>Tiếp nhận bệnh nhân mới</h5>
        <form id="createPatientForm">
            <div class="row g-3">
                <div class="col-md-8">
                    <label class="form-label">Họ và tên <span class="text-danger">*</span></label>
                    <input type="text" name="TenBenhNhan" class="form-control fw-bold text-uppercase" required placeholder="NGUYỄN VĂN A">
                </div>
                <div class="col-md-4">
                    <label class="form-label">Nhóm máu</label>
                    <select name="NhomMau" class="form-select">
                        <option value="">-- Chưa rõ --</option>
                        <option value="A">Nhóm A</option>
                        <option value="B">Nhóm B</option>
                        <option value="AB">Nhóm AB</option>
                        <option value="O">Nhóm O</option>
                    </select>
                </div>

                <div class="col-md-4">
                    <label class="form-label">Ngày sinh</label>
                    <input type="date" name="NgaySinh" class="form-control" 
                           max="@DateTime.Now.ToString("yyyy-MM-dd")"
                           value="@(Model?.NgaySinh?.ToString("yyyy-MM-dd") ?? "")">
                    <div class="form-text text-muted small">Phải nhỏ hơn ngày hiện tại</div>
                </div>
                <div class="col-md-4">
                    <label class="form-label">Giới tính</label>
                    <select name="GioiTinh" class="form-select">
                        <option value="Nam">Nam</option>
                        <option value="Nu">Nữ</option>
                    </select>
                </div>
                <div class="col-md-4">
                    <label class="form-label">CCCD/CMND</label>
                    <input type="text" name="CCCD" class="form-control" placeholder="Để trống nếu chưa có">
                </div>

                <div class="col-md-6">
                    <label class="form-label">Số điện thoại <span class="text-danger">*</span></label>
                    <input type="tel" name="SoDienThoai" class="form-control" required>
                </div>
                <div class="col-md-6">
                    <label class="form-label">Email</label>
                    <input type="email" name="Email" class="form-control" placeholder="abc@gmail.com">
                </div>

                <div class="col-md-6">
                    <label class="form-label">Nghề nghiệp</label>
                    <input type="text" name="NgheNghiep" class="form-control">
                </div>
                <div class="col-md-6">
                    <label class="form-label">Số thẻ BHYT</label>
                    <input type="text" name="MaTheBHYT" class="form-control" placeholder="Nhập mã thẻ nếu có">
                </div>

                <div class="col-12">
                    <label class="form-label">Địa chỉ</label>
                    <input type="text" name="DiaChi" class="form-control" placeholder="Số nhà, đường, phường/xã...">
                </div>

                <div class="col-12">
                    <label class="form-label text-danger"><i class="fas fa-notes-medical me-1"></i>Tiền sử bệnh / Dị ứng</label>
                    <textarea name="TienSuDiUng" class="form-control" rows="2" placeholder="Ví dụ: Dị ứng Penicillin, Tiền sử cao huyết áp..."></textarea>
                </div>
            </div>

            <div class="text-end mt-4 pt-3 border-top">
                <button type="button" class="btn btn-secondary" onclick="loadPatientsContent('/Admin/BenhNhan/_DSBenhNhan')">Hủy bỏ</button>
                <button type="submit" class="btn btn-primary px-4"><i class="fas fa-save me-2"></i>Lưu hồ sơ</button>
            </div>
        </form>
    </div>
</div>

<script>
    $('#createPatientForm').off('submit').on('submit', function(e) {
        e.preventDefault();
        $.ajax({
            url: '/Admin/BenhNhan/Create',
            type: 'POST',
            data: $(this).serialize(),
            success: function(res) {
                if (res.success) {
                    showToast(res.message, 'success');
                    loadPatientsContent('/Admin/BenhNhan/_DSBenhNhan');
                } else {
                    Swal.fire('Lỗi', res.message, 'error');
                }
            }
        });
    });
</script>