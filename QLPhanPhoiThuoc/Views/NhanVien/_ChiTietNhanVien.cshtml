@model QLPhanPhoiThuoc.Models.Entities.NhanVien

<div class="p-4">
    <div class="row">
        <div class="col-md-4 text-center border-end">
            <div class="mb-3">
                @{
                    // Logic hiển thị ảnh an toàn
                    string avatarPath = "/images/default-avatar.png";
                    if (Model.TaiKhoan != null && !string.IsNullOrEmpty(Model.TaiKhoan.Avatar))
                    {
                        avatarPath = Model.TaiKhoan.Avatar;
                    }
                    else if (!string.IsNullOrEmpty(Model.TaiKhoan?.Avatar))
                    {
                        avatarPath = Model.TaiKhoan?.Avatar;
                    }
                }
                <img src="@avatarPath" class="rounded-circle img-thumbnail shadow-sm" 
                     style="width: 150px; height: 150px; object-fit: cover;">
            </div>
            <h5 class="fw-bold text-primary mb-1">@Model.TenNhanVien</h5>
            <span class="badge bg-info text-dark">@Model.ChucVu</span>

            <div class="mt-3">
                @if (Model.TrangThai == "DangLamViec")
                {
                        <span class="badge bg-success"><i class="fas fa-check-circle me-1"></i> Đang làm việc</span>
                }
                else
                {
                        <span class="badge bg-danger"><i class="fas fa-times-circle me-1"></i> Đã nghỉ việc</span>
                }
            </div>
        </div>

        <div class="col-md-8 ps-4">
            <h6 class="text-uppercase text-muted small fw-bold mb-3 border-bottom pb-2">Thông tin cá nhân</h6>

            <table class="table table-borderless table-sm">
                <tr>
                    <td class="fw-bold text-secondary" style="width: 140px;">Mã nhân viên:</td>
                    <td>@Model.MaNhanVien</td>
                </tr>
                <tr>
                    <td class="fw-bold text-secondary">Khoa/Phòng:</td>
                    <td>@(Model.KhoaPhong?.TenKhoa ?? "---")</td>
                </tr>
                <tr>
                    <td class="fw-bold text-secondary">Số điện thoại:</td>
                    <td>@Model.SoDienThoai</td>
                </tr>
                <tr>
                    <td class="fw-bold text-secondary">Email:</td>
                    <td>@Model.Email</td>
                </tr>
                <tr>
                    <td class="fw-bold text-secondary">Ngày vào làm:</td>
                    <td>@(Model.NgayVaoLam?.ToString("dd/MM/yyyy") ?? "---")</td>
                </tr>
            </table>

            <h6 class="text-uppercase text-muted small fw-bold mb-3 mt-4 border-bottom pb-2">Thông tin tài khoản</h6>
            @if (Model.TaiKhoan != null)
            {
                    <table class="table table-borderless table-sm">
                        <tr>
                            <td class="fw-bold text-secondary" style="width: 140px;">Tên đăng nhập:</td>
                            <td class="fw-bold text-primary">@Model.TaiKhoan.Username</td>
                        </tr>
                        <tr>
                            <td class="fw-bold text-secondary">Quyền hạn:</td>
                            <td><span class="badge bg-secondary">@Model.TaiKhoan.Role</span></td>
                        </tr>
                    </table>
            }
            else
            {
                    <div class="alert alert-warning py-2 small">
                        <i class="fas fa-exclamation-triangle me-1"></i> Chưa được cấp tài khoản hệ thống.
                    </div>
            }
        </div>
    </div>

    <div class="text-end mt-4 pt-3 border-top">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
        <button type="button" class="btn btn-primary" onclick="switchToEdit('@Model.MaNhanVien')">
            <i class="fas fa-edit me-1"></i> Chỉnh sửa
        </button>
    </div>
</div>

<script>
    // Hàm chuyển từ Xem -> Sửa
    function switchToEdit(id) {
        // Ẩn modal hiện tại
        var modalEl = document.getElementById('commonModal');
        var modal = bootstrap.Modal.getInstance(modalEl);
        if (modal) modal.hide();

        // Đợi 1 xíu rồi gọi hàm sửa (để modal tắt hẳn hiệu ứng)
        setTimeout(() => {
            if (typeof editEmployee === 'function') {
                editEmployee(id);
            }
        }, 300);
    }
</script>