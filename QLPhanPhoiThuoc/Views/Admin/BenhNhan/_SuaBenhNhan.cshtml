@model QLPhanPhoiThuoc.Models.Entities.BenhNhan

<div class="modal-header bg-warning text-white">
    <h5 class="modal-title">
        <i class="fas fa-edit me-2"></i>
        Chỉnh sửa thông tin bệnh nhân
    </h5>
    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
</div>

<form id="editPatientForm">
    <div class="modal-body">
        <input type="hidden" id="edit_MaBenhNhan" value="@Model.MaBenhNhan" />

        <div class="row">
            <div class="col-md-6 mb-3">
                <label class="form-label">
                    <i class="fas fa-user me-2"></i>Họ và tên <span class="text-danger">*</span>
                </label>
                <input type="text" class="form-control" id="edit_TenBenhNhan" value="@Model.TenBenhNhan" required />
            </div>

            <div class="col-md-6 mb-3">
                <label class="form-label">
                    <i class="fas fa-id-card me-2"></i>Số CCCD
                </label>
                <input type="text" class="form-control" id="edit_CCCD" value="@Model.CCCD" />
            </div>

            <div class="col-md-6 mb-3">
                <label class="form-label">
                    <i class="fas fa-phone me-2"></i>Số điện thoại <span class="text-danger">*</span>
                </label>
                <input type="tel" class="form-control" id="edit_SoDienThoai" value="@Model.SoDienThoai" required />
            </div>

            <div class="col-md-6 mb-3">
                <label class="form-label">
                    <i class="fas fa-envelope me-2"></i>Email
                </label>
                <input type="email" class="form-control" id="edit_Email" value="@Model.Email" />
            </div>

            <div class="col-md-6 mb-3">
                <label class="form-label">
                    <i class="fas fa-birthday-cake me-2"></i>Ngày sinh
                </label>
                <input type="date" class="form-control" id="edit_NgaySinh" 
                       value="@(Model.NgaySinh?.ToString("yyyy-MM-dd"))" />
            </div>

            <div class="col-md-6 mb-3">
                <label class="form-label">
                    <i class="fas fa-venus-mars me-2"></i>Giới tính
                </label>
                <select class="form-select" id="edit_GioiTinh">
                    <option value="Nam" selected="@(Model.GioiTinh == "Nam")">Nam</option>
                    <option value="Nữ" selected="@(Model.GioiTinh == "Nữ")">Nữ</option>
                </select>
            </div>

            <div class="col-md-12 mb-3">
                <label class="form-label">
                    <i class="fas fa-map-marker-alt me-2"></i>Địa chỉ
                </label>
                <textarea class="form-control" id="edit_DiaChi" rows="2">@Model.DiaChi</textarea>
            </div>

            <div class="col-md-6 mb-3">
                <label class="form-label">
                    <i class="fas fa-heartbeat me-2"></i>Trạng thái
                </label>
                <select class="form-select" id="edit_TrangThai">
                    <option value="DangDieuTri" selected="@(Model.TrangThai == "DangDieuTri")">Đang điều trị</option>
                    <option value="DaRaVien" selected="@(Model.TrangThai == "DaRaVien")">Đã ra viện</option>
                </select>
            </div>
        </div>
    </div>

    <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
            <i class="fas fa-times me-2"></i>Hủy
        </button>
        <button type="submit" class="btn btn-primary">
            <i class="fas fa-save me-2"></i>Lưu thay đổi
        </button>
    </div>
</form>

<script>
    $('#editPatientForm').on('submit', function(e) {
        e.preventDefault();

        const data = {
            MaBenhNhan: $('#edit_MaBenhNhan').val(),
            TenBenhNhan: $('#edit_TenBenhNhan').val(),
            CCCD: $('#edit_CCCD').val(),
            SoDienThoai: $('#edit_SoDienThoai').val(),
            Email: $('#edit_Email').val(),
            NgaySinh: $('#edit_NgaySinh').val(),
            GioiTinh: $('#edit_GioiTinh').val(),
            DiaChi: $('#edit_DiaChi').val(),
            TrangThai: $('#edit_TrangThai').val()
        };

        $.ajax({
            url: '/Admin/BenhNhan/SuaBenhNhan',
            type: 'POST',
            contentType: 'application/json',
            data: JSON.stringify(data),
            success: function(response) {
                if (response.success) {
                    $('#patientModal').modal('hide');
                    Swal.fire({
                        icon: 'success',
                        title: 'Thành công!',
                        text: 'Cập nhật thông tin bệnh nhân thành công',
                        timer: 2000
                    });
                    // Reload danh sách
                    loadContent('/Admin/BenhNhan/_DSBenhNhan');
                } else {
                    Swal.fire({
                        icon: 'error',
                        title: 'Lỗi!',
                        text: response.message || 'Có lỗi xảy ra'
                    });
                }
            },
            error: function() {
                Swal.fire({
                    icon: 'error',
                    title: 'Lỗi!',
                    text: 'Không thể kết nối đến server'
                });
            }
        });
    });
</script>