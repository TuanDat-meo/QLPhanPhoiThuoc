@{
    ViewData["Title"] = "Trang quản trị";
    Layout = "~/Views/Shared/_Layout.cshtml";
    var chucVu = ViewBag.ChucVu ?? "Quản trị viên";
    var tenNhanVien = ViewBag.TenNhanVien ?? "Admin";
    var maNhanVien = ViewBag.MaNhanVien ?? "";
    var userRole = User.FindFirst(System.Security.Claims.ClaimTypes.Role)?.Value ?? "Admin";
}

<style>
    /* ==================== MODERN COMPACT SIDEBAR LAYOUT ==================== */
    
    .admin-container {
        display: flex;
        gap: 25px;
        min-height: calc(100vh - 200px);
        padding: 20px;
    }

    /* ==================== COMPACT SIDEBAR ==================== */
    .sidebar {
        width: 260px;
        background: white;
        border-radius: 12px;
        box-shadow: 0 2px 12px rgba(0,0,0,0.08);
        padding: 0;
        height: fit-content;
        max-height: calc(100vh - 140px);
        overflow-y: auto;
        position: sticky;
        top: 90px;
    }

    .sidebar::-webkit-scrollbar {
        width: 5px;
    }

    .sidebar::-webkit-scrollbar-track {
        background: #f1f1f1;
    }

    .sidebar::-webkit-scrollbar-thumb {
        background: #1e3a5f;
        border-radius: 10px;
    }

    .sidebar-header {
        padding: 20px;
        border-bottom: 1px solid #e9ecef;
        background: linear-gradient(135deg, #1e3a5f 0%, #0f2847 100%);
        border-radius: 12px 12px 0 0;
        color: white;
    }

    .sidebar-title {
        font-size: 1.1rem;
        font-weight: 700;
        margin: 0;
    }

    .sidebar-subtitle {
        font-size: 0.85rem;
        opacity: 0.9;
        margin-top: 3px;
    }

    /* Menu Accordion */
    .menu-accordion {
        padding: 10px 0;
    }

    .menu-group {
        margin-bottom: 5px;
    }

    .menu-group-header {
        padding: 12px 20px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: space-between;
        transition: all 0.3s ease;
        border-left: 3px solid transparent;
        color: #495057;
        font-weight: 500;
        user-select: none;
    }

    .menu-group-header:hover {
        background: #f8f9fa;
        color: #1e3a5f;
        border-left-color: #1e3a5f;
    }

    .menu-group-header.active {
        background: linear-gradient(90deg, rgba(30,58,95,0.1) 0%, transparent 100%);
        color: #1e3a5f;
        border-left-color: #1e3a5f;
        font-weight: 600;
    }

    .menu-header-content {
        display: flex;
        align-items: center;
        gap: 12px;
        flex: 1;
    }

    .menu-header-content i {
        width: 22px;
        text-align: center;
        font-size: 1.1rem;
    }

    .menu-arrow {
        transition: transform 0.3s ease;
        font-size: 0.85rem;
        color: #6c757d;
    }

    .menu-group-header.active .menu-arrow {
        transform: rotate(90deg);
        color: #1e3a5f;
    }

    /* Submenu */
    .menu-submenu {
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.3s ease;
        background: #f8f9fa;
    }

    .menu-submenu.show {
        max-height: 500px;
    }

    .submenu-item {
        padding: 10px 20px 10px 54px;
        color: #6c757d;
        text-decoration: none;
        display: flex;
        align-items: center;
        gap: 10px;
        transition: all 0.2s ease;
        border-left: 3px solid transparent;
        cursor: pointer;
        font-size: 0.9rem;
    }

    .submenu-item:hover {
        background: white;
        color: #1e3a5f;
        border-left-color: #38bdf8;
        text-decoration: none;
        padding-left: 58px;
    }

    .submenu-item.active {
        background: white;
        color: #1e3a5f;
        border-left-color: #1e3a5f;
        font-weight: 600;
    }

    .submenu-item i {
        font-size: 0.75rem;
        width: 12px;
    }

    /* Badge */
    .menu-badge {
        background: linear-gradient(135deg, #f5576c 0%, #f093fb 100%);
        color: white;
        font-size: 0.7rem;
        padding: 2px 8px;
        border-radius: 12px;
        font-weight: 600;
        margin-left: auto;
    }

    /* ==================== MAIN CONTENT AREA ==================== */
    .dashboard-content {
        flex: 1;
        min-width: 0;
    }

    /* Welcome Banner */
    .welcome-banner {
        background: linear-gradient(135deg, #1e3a5f 0%, #0f2847 100%);
        color: white;
        padding: 25px 30px;
        border-radius: 12px;
        box-shadow: 0 4px 20px rgba(30, 58, 95, 0.3);
        margin-bottom: 25px;
        display: flex;
        align-items: center;
        justify-content: space-between;
    }

    .welcome-content {
        display: flex;
        align-items: center;
        gap: 20px;
    }

    .welcome-icon {
        width: 60px;
        height: 60px;
        background: rgba(255, 255, 255, 0.2);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.8rem;
    }

    .welcome-text h3 {
        margin: 0;
        font-size: 1.5rem;
        font-weight: 700;
        color: white;
    }

    .welcome-text p {
        margin: 5px 0 0;
        opacity: 0.9;
        font-size: 0.95rem;
    }

    /* Content Section */
    .content-section {
        display: none;
    }

    .content-section.active {
        display: block;
        animation: fadeIn 0.3s ease;
    }

    @@keyframes fadeIn {
        from {
            opacity: 0;
            transform: translateY(10px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .section-header {
        background: white;
        padding: 20px 25px;
        border-radius: 12px;
        margin-bottom: 20px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        display: flex;
        align-items: center;
        justify-content: space-between;
    }

    .section-title {
        display: flex;
        align-items: center;
        gap: 12px;
        margin: 0;
        color: #1e3a5f;
        font-weight: 700;
        font-size: 1.3rem;
    }

    .section-title i {
        width: 40px;
        height: 40px;
        background: linear-gradient(135deg, #1e3a5f 0%, #0f2847 100%);
        color: white;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    /* Tabs */
    .content-tabs {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
        background: white;
        padding: 15px 20px;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        overflow-x: auto;
    }

    .tab-btn {
        padding: 10px 20px;
        border: 2px solid #e9ecef;
        background: white;
        color: #6c757d;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s ease;
        font-weight: 500;
        white-space: nowrap;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .tab-btn:hover {
        border-color: #1e3a5f;
        color: #1e3a5f;
        background: #f8f9fa;
    }

    .tab-btn.active {
        background: linear-gradient(135deg, #1e3a5f 0%, #0f2847 100%);
        color: white;
        border-color: #1e3a5f;
        box-shadow: 0 4px 12px rgba(30, 58, 95, 0.3);
    }

    .tab-content {
        display: none;
    }

    .tab-content.active {
        display: block;
        animation: fadeIn 0.3s ease;
    }

    /* Cards */
    .card {
        background: white;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        margin-bottom: 20px;
        border: none;
    }

    .card-header {
        background: #f8f9fa;
        border-bottom: 1px solid #e9ecef;
        padding: 15px 20px;
        border-radius: 12px 12px 0 0;
        font-weight: 600;
        color: #1e3a5f;
    }

    .card-body {
        padding: 20px;
    }

    /* Stats Grid */
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        gap: 20px;
        margin-bottom: 25px;
    }

    .stat-card {
        background: white;
        padding: 20px;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        display: flex;
        align-items: center;
        gap: 15px;
        transition: all 0.3s ease;
        border: 1px solid #e9ecef;
    }

    .stat-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 20px rgba(0,0,0,0.12);
    }

    .stat-icon {
        width: 50px;
        height: 50px;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        color: white;
        flex-shrink: 0;
    }

    .stat-icon.primary {
        background: linear-gradient(135deg, #1e3a5f 0%, #0f2847 100%);
    }

    .stat-icon.success {
        background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
    }

    .stat-icon.warning {
        background: linear-gradient(135deg, #f59e0b 0%, #fb923c 100%);
    }

    .stat-icon.danger {
        background: linear-gradient(135deg, #f5576c 0%, #f093fb 100%);
    }

    .stat-details {
        flex: 1;
    }

    .stat-value {
        font-size: 1.8rem;
        font-weight: 700;
        color: #1e3a5f;
        margin-bottom: 3px;
    }

    .stat-label {
        color: #6c757d;
        font-size: 0.9rem;
    }

    /* Table Styles */
    .table-container {
        background: white;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }

    .table {
        margin-bottom: 0;
    }

    .table thead th {
        background: #f8f9fa;
        color: #1e3a5f;
        font-weight: 600;
        border-bottom: 2px solid #e9ecef;
        padding: 15px;
    }

    .table tbody td {
        padding: 12px 15px;
        vertical-align: middle;
    }

    .table tbody tr:hover {
        background: #f8f9fa;
    }

    /* Action Buttons */
    .action-btn {
        padding: 8px 16px;
        border-radius: 6px;
        border: none;
        cursor: pointer;
        transition: all 0.3s ease;
        font-weight: 500;
        display: inline-flex;
        align-items: center;
        gap: 6px;
        font-size: 0.9rem;
    }

    .btn-primary-custom {
        background: linear-gradient(135deg, #1e3a5f 0%, #0f2847 100%);
        color: white;
    }

    .btn-primary-custom:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(30, 58, 95, 0.3);
    }

    .btn-success-custom {
        background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        color: white;
    }

    .btn-danger-custom {
        background: linear-gradient(135deg, #f5576c 0%, #f093fb 100%);
        color: white;
    }

    .btn-warning-custom {
        background: linear-gradient(135deg, #f59e0b 0%, #fb923c 100%);
        color: white;
    }

    /* Responsive */
    @@media (max-width: 992px) {
        .admin-container {
            flex-direction: column;
        }
        
        .sidebar {
            width: 100%;
            position: relative;
            top: 0;
            max-height: none;
        }
    }
</style>

<div class="container-fluid">
    <!-- Welcome Banner -->
    <div class="welcome-banner">
        <div class="welcome-content">
            <div class="welcome-icon">
                <i class="fas fa-user-shield"></i>
            </div>
            <div class="welcome-text">
                <h3>Xin chào, @tenNhanVien!</h3>
                <p>@chucVu | Mã NV: @maNhanVien</p>
            </div>
        </div>
    </div>

    <!-- Main Container -->
    <div class="admin-container">
        <!-- Compact Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-title">
                    <i class="fas fa-th-large me-2"></i>
                    Bảng điều khiển
                </div>
                <div class="sidebar-subtitle">Quản lý toàn diện</div>
            </div>

            <div class="menu-accordion">
                <!-- Dashboard -->
                <div class="menu-group">
                    <div class="menu-group-header active" data-section="dashboard">
                        <div class="menu-header-content">
                            <i class="fas fa-chart-line"></i>
                            <span>Tổng quan</span>
                        </div>
                    </div>
                </div>

                <!-- Quản lý bệnh nhân -->
                <div class="menu-group">
                    <div class="menu-group-header" data-section="patients">
                        <div class="menu-header-content">
                            <i class="fas fa-user-injured"></i>
                            <span>Bệnh nhân</span>
                        </div>
                        <i class="fas fa-chevron-right menu-arrow"></i>
                    </div>
                    <div class="menu-submenu">
                        <a href="#" class="submenu-item" data-tab="patient-list">
                            <i class="fas fa-circle"></i>
                            <span>Danh sách bệnh nhân</span>
                        </a>
                        <a href="#" class="submenu-item" data-tab="patient-add">
                            <i class="fas fa-circle"></i>
                            <span>Thêm bệnh nhân mới</span>
                        </a>
                        <a href="#" class="submenu-item" data-tab="patient-medical">
                            <i class="fas fa-circle"></i>
                            <span>Hồ sơ bệnh án</span>
                        </a>
                    </div>
                </div>

                <!-- Quản lý thuốc -->
                <div class="menu-group">
                    <div class="menu-group-header" data-section="medicines">
                        <div class="menu-header-content">
                            <i class="fas fa-pills"></i>
                            <span>Thuốc</span>
                        </div>
                        <span class="menu-badge">12</span>
                        <i class="fas fa-chevron-right menu-arrow"></i>
                    </div>
                    <div class="menu-submenu">
                        <a href="#" class="submenu-item" data-tab="medicine-list">
                            <i class="fas fa-circle"></i>
                            <span>Danh sách thuốc</span>
                        </a>
                        <a href="#" class="submenu-item" data-tab="medicine-inventory">
                            <i class="fas fa-circle"></i>
                            <span>Quản lý kho</span>
                        </a>
                        <a href="#" class="submenu-item" data-tab="medicine-expired">
                            <i class="fas fa-circle"></i>
                            <span>Thuốc hết hạn</span>
                            <span class="menu-badge" style="font-size: 0.65rem;">12</span>
                        </a>
                        <a href="#" class="submenu-item" data-tab="medicine-import">
                            <i class="fas fa-circle"></i>
                            <span>Nhập kho</span>
                        </a>
                    </div>
                </div>

                <!-- Đơn thuốc -->
                <div class="menu-group">
                    <div class="menu-group-header" data-section="prescriptions">
                        <div class="menu-header-content">
                            <i class="fas fa-prescription"></i>
                            <span>Đơn thuốc</span>
                        </div>
                        <i class="fas fa-chevron-right menu-arrow"></i>
                    </div>
                    <div class="menu-submenu">
                        <a href="#" class="submenu-item" data-tab="prescription-list">
                            <i class="fas fa-circle"></i>
                            <span>Danh sách đơn thuốc</span>
                        </a>
                        <a href="#" class="submenu-item" data-tab="prescription-create">
                            <i class="fas fa-circle"></i>
                            <span>Tạo đơn thuốc mới</span>
                        </a>
                        <a href="#" class="submenu-item" data-tab="prescription-history">
                            <i class="fas fa-circle"></i>
                            <span>Lịch sử kê đơn</span>
                        </a>
                    </div>
                </div>

                <!-- Hóa đơn -->
                <div class="menu-group">
                    <div class="menu-group-header" data-section="invoices">
                        <div class="menu-header-content">
                            <i class="fas fa-file-invoice-dollar"></i>
                            <span>Hóa đơn</span>
                        </div>
                        <i class="fas fa-chevron-right menu-arrow"></i>
                    </div>
                    <div class="menu-submenu">
                        <a href="#" class="submenu-item" data-tab="invoice-list">
                            <i class="fas fa-circle"></i>
                            <span>Danh sách hóa đơn</span>
                        </a>
                        <a href="#" class="submenu-item" data-tab="invoice-pending">
                            <i class="fas fa-circle"></i>
                            <span>Chờ thanh toán</span>
                        </a>
                        <a href="#" class="submenu-item" data-tab="invoice-paid">
                            <i class="fas fa-circle"></i>
                            <span>Đã thanh toán</span>
                        </a>
                    </div>
                </div>

                <!-- Nhà cung cấp -->
                <div class="menu-group">
                    <div class="menu-group-header" data-section="suppliers">
                        <div class="menu-header-content">
                            <i class="fas fa-truck"></i>
                            <span>Nhà cung cấp</span>
                        </div>
                        <i class="fas fa-chevron-right menu-arrow"></i>
                    </div>
                    <div class="menu-submenu">
                        <a href="#" class="submenu-item" data-tab="supplier-list">
                            <i class="fas fa-circle"></i>
                            <span>Danh sách NCC</span>
                        </a>
                        <a href="#" class="submenu-item" data-tab="supplier-orders">
                            <i class="fas fa-circle"></i>
                            <span>Đơn đặt hàng</span>
                        </a>
                    </div>
                </div>

                @if (userRole == "Admin")
                {
                    <!-- Nhân viên (chỉ Admin) -->
                    <div class="menu-group">
                        <div class="menu-group-header" data-section="employees">
                            <div class="menu-header-content">
                                <i class="fas fa-users"></i>
                                <span>Nhân viên</span>
                            </div>
                            <i class="fas fa-chevron-right menu-arrow"></i>
                        </div>
                        <div class="menu-submenu">
                            <a href="#" class="submenu-item" data-tab="employee-list">
                                <i class="fas fa-circle"></i>
                                <span>Danh sách nhân viên</span>
                            </a>
                            <a href="#" class="submenu-item" data-tab="employee-add">
                                <i class="fas fa-circle"></i>
                                <span>Thêm nhân viên</span>
                            </a>
                            <a href="#" class="submenu-item" data-tab="employee-roles">
                                <i class="fas fa-circle"></i>
                                <span>Phân quyền</span>
                            </a>
                        </div>
                    </div>

                    <!-- Báo cáo -->
                    <div class="menu-group">
                        <div class="menu-group-header" data-section="reports">
                            <div class="menu-header-content">
                                <i class="fas fa-chart-bar"></i>
                                <span>Báo cáo</span>
                            </div>
                            <i class="fas fa-chevron-right menu-arrow"></i>
                        </div>
                        <div class="menu-submenu">
                            <a href="#" class="submenu-item" data-tab="report-revenue">
                                <i class="fas fa-circle"></i>
                                <span>Báo cáo doanh thu</span>
                            </a>
                            <a href="#" class="submenu-item" data-tab="report-inventory">
                                <i class="fas fa-circle"></i>
                                <span>Báo cáo tồn kho</span>
                            </a>
                            <a href="#" class="submenu-item" data-tab="report-usage">
                                <i class="fas fa-circle"></i>
                                <span>Thống kê sử dụng</span>
                            </a>
                        </div>
                    </div>
                }

                <!-- Cài đặt -->
                <div class="menu-group">
                    <div class="menu-group-header" data-section="settings">
                        <div class="menu-header-content">
                            <i class="fas fa-cog"></i>
                            <span>Cài đặt</span>
                        </div>
                        <i class="fas fa-chevron-right menu-arrow"></i>
                    </div>
                    <div class="menu-submenu">
                        <a href="#" class="submenu-item" data-tab="settings-general">
                            <i class="fas fa-circle"></i>
                            <span>Cài đặt chung</span>
                        </a>
                        <a href="#" class="submenu-item" data-tab="settings-profile">
                            <i class="fas fa-circle"></i>
                            <span>Hồ sơ cá nhân</span>
                        </a>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="dashboard-content">
            <!-- Dashboard Section (Default) -->
            <div id="dashboard" class="content-section active">
                <div class="section-header">
                    <h2 class="section-title">
                        <i class="fas fa-chart-line"></i>
                        Tổng quan hệ thống
                    </h2>
                </div>

                <!-- Stats -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon primary">
                            <i class="fas fa-user-injured"></i>
                        </div>
                        <div class="stat-details">
                            <div class="stat-value">1,234</div>
                            <div class="stat-label">Tổng bệnh nhân</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon success">
                            <i class="fas fa-pills"></i>
                        </div>
                        <div class="stat-details">
                            <div class="stat-value">456</div>
                            <div class="stat-label">Loại thuốc</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon warning">
                            <i class="fas fa-prescription"></i>
                        </div>
                        <div class="stat-details">
                            <div class="stat-value">89</div>
                            <div class="stat-label">Đơn hôm nay</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon danger">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                        <div class="stat-details">
                            <div class="stat-value">12</div>
                            <div class="stat-label">Thuốc hết hạn</div>
                        </div>
                    </div>
                </div>

                <!-- Charts Grid -->
                <div class="row">
                    <div class="col-md-8">
                        <div class="card">
                            <div class="card-header">
                                <i class="fas fa-chart-line me-2"></i>Biểu đồ doanh thu 7 ngày
                            </div>
                            <div class="card-body">
                                <div style="height: 300px; position: relative;">
                                    <canvas id="revenueChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-header">
                                <i class="fas fa-chart-pie me-2"></i>Phân loại bệnh nhân
                            </div>
                            <div class="card-body">
                                <div style="height: 300px; position: relative;">
                                    <canvas id="patientChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recent Activities -->
                <div class="card">
                    <div class="card-header">
                        <i class="fas fa-history me-2"></i>Hoạt động gần đây
                    </div>
                    <div class="card-body p-0">
                        <div class="table-container">
                            <table class="table mb-0">
                                <tbody>
                                    <tr>
                                        <td style="width: 50px; text-align: center;">
                                            <div style="width: 35px; height: 35px; background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); border-radius: 8px; display: flex; align-items: center; justify-content: center; color: white;">
                                                <i class="fas fa-check"></i>
                                            </div>
                                        </td>
                                        <td>
                                            <strong>Đã xử lý đơn thuốc #DT20260203001</strong>
                                            <br>
                                            <small class="text-muted">5 phút trước</small>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style="width: 50px; text-align: center;">
                                            <div style="width: 35px; height: 35px; background: linear-gradient(135deg, #1e3a5f 0%, #0f2847 100%); border-radius: 8px; display: flex; align-items: center; justify-content: center; color: white;">
                                                <i class="fas fa-user-plus"></i>
                                            </div>
                                        </td>
                                        <td>
                                            <strong>Bệnh nhân mới: Nguyễn Văn A</strong>
                                            <br>
                                            <small class="text-muted">15 phút trước</small>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style="width: 50px; text-align: center;">
                                            <div style="width: 35px; height: 35px; background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); border-radius: 8px; display: flex; align-items: center; justify-content: center; color: white;">
                                                <i class="fas fa-file-import"></i>
                                            </div>
                                        </td>
                                        <td>
                                            <strong>Nhập kho thuốc từ NCC ABC</strong>
                                            <br>
                                            <small class="text-muted">1 giờ trước</small>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style="width: 50px; text-align: center;">
                                            <div style="width: 35px; height: 35px; background: linear-gradient(135deg, #f5576c 0%, #f093fb 100%); border-radius: 8px; display: flex; align-items: center; justify-content: center; color: white;">
                                                <i class="fas fa-bell"></i>
                                            </div>
                                        </td>
                                        <td>
                                            <strong>Cảnh báo: 12 loại thuốc sắp hết hạn</strong>
                                            <br>
                                            <small class="text-muted">2 giờ trước</small>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Patients Section -->
            <div id="patients" class="content-section">
                <div class="section-header">
                    <h2 class="section-title">
                        <i class="fas fa-user-injured"></i>
                        Quản lý bệnh nhân
                    </h2>
                    <button class="action-btn btn-primary-custom">
                        <i class="fas fa-plus"></i>
                        Thêm bệnh nhân
                    </button>
                </div>

                <!-- Tabs -->
                <div class="content-tabs">
                    <button class="tab-btn active" data-target="patient-list">
                        <i class="fas fa-list"></i>
                        Danh sách
                    </button>
                    <button class="tab-btn" data-target="patient-add">
                        <i class="fas fa-user-plus"></i>
                        Thêm mới
                    </button>
                    <button class="tab-btn" data-target="patient-medical">
                        <i class="fas fa-file-medical"></i>
                        Hồ sơ bệnh án
                    </button>
                </div>

                <!-- Tab Contents -->
                <div id="patient-list" class="tab-content active">
                    <div class="table-container">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Mã BN</th>
                                    <th>Họ tên</th>
                                    <th>Ngày sinh</th>
                                    <th>Giới tính</th>
                                    <th>Số điện thoại</th>
                                    <th>Email</th>
                                    <th>Thao tác</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>BN001</td>
                                    <td>Nguyễn Văn A</td>
                                    <td>01/01/1990</td>
                                    <td>Nam</td>
                                    <td>0123456789</td>
                                    <td>nguyenvana@email.com</td>
                                    <td>
                                        <button class="action-btn btn-primary-custom" style="padding: 5px 10px; font-size: 0.85rem;">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                    </td>
                                </tr>
                                <!-- More rows... -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <div id="patient-add" class="tab-content">
                    <div class="card">
                        <div class="card-header">Thông tin bệnh nhân mới</div>
                        <div class="card-body">
                            <p class="text-muted">Form thêm bệnh nhân sẽ được hiển thị ở đây...</p>
                        </div>
                    </div>
                </div>

                <div id="patient-medical" class="tab-content">
                    <div class="card">
                        <div class="card-header">Hồ sơ bệnh án</div>
                        <div class="card-body">
                            <p class="text-muted">Danh sách hồ sơ bệnh án sẽ được hiển thị ở đây...</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Medicines Section -->
            <div id="medicines" class="content-section">
                <div class="section-header">
                    <h2 class="section-title">
                        <i class="fas fa-pills"></i>
                        Quản lý thuốc
                    </h2>
                    <button class="action-btn btn-primary-custom">
                        <i class="fas fa-plus"></i>
                        Thêm thuốc
                    </button>
                </div>

                <div class="content-tabs">
                    <button class="tab-btn active" data-target="medicine-list">
                        <i class="fas fa-list"></i>
                        Danh sách thuốc
                    </button>
                    <button class="tab-btn" data-target="medicine-inventory">
                        <i class="fas fa-warehouse"></i>
                        Quản lý kho
                    </button>
                    <button class="tab-btn" data-target="medicine-expired">
                        <i class="fas fa-exclamation-triangle"></i>
                        Thuốc hết hạn
                        <span class="menu-badge" style="font-size: 0.65rem;">12</span>
                    </button>
                    <button class="tab-btn" data-target="medicine-import">
                        <i class="fas fa-file-import"></i>
                        Nhập kho
                    </button>
                </div>

                <div id="medicine-list" class="tab-content active">
                    <div class="card">
                        <div class="card-header">Danh sách thuốc</div>
                        <div class="card-body">
                            <p class="text-muted">Danh sách thuốc sẽ được hiển thị ở đây...</p>
                        </div>
                    </div>
                </div>

                <div id="medicine-inventory" class="tab-content">
                    <div class="card">
                        <div class="card-header">Quản lý tồn kho</div>
                        <div class="card-body">
                            <p class="text-muted">Thông tin tồn kho sẽ được hiển thị ở đây...</p>
                        </div>
                    </div>
                </div>

                <div id="medicine-expired" class="tab-content">
                    <div class="card">
                        <div class="card-header">Danh sách thuốc hết hạn</div>
                        <div class="card-body">
                            <p class="text-muted">Danh sách thuốc hết hạn sẽ được hiển thị ở đây...</p>
                        </div>
                    </div>
                </div>

                <div id="medicine-import" class="tab-content">
                    <div class="card">
                        <div class="card-header">Nhập kho thuốc</div>
                        <div class="card-body">
                            <p class="text-muted">Form nhập kho sẽ được hiển thị ở đây...</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Prescriptions Section -->
            <div id="prescriptions" class="content-section">
                <div class="section-header">
                    <h2 class="section-title">
                        <i class="fas fa-prescription"></i>
                        Quản lý đơn thuốc
                    </h2>
                    <button class="action-btn btn-primary-custom">
                        <i class="fas fa-plus"></i>
                        Tạo đơn mới
                    </button>
                </div>

                <div class="content-tabs">
                    <button class="tab-btn active" data-target="prescription-list">
                        <i class="fas fa-list"></i>
                        Danh sách đơn thuốc
                    </button>
                    <button class="tab-btn" data-target="prescription-create">
                        <i class="fas fa-plus-circle"></i>
                        Tạo đơn mới
                    </button>
                    <button class="tab-btn" data-target="prescription-history">
                        <i class="fas fa-history"></i>
                        Lịch sử kê đơn
                    </button>
                </div>

                <div id="prescription-list" class="tab-content active">
                    <div class="card">
                        <div class="card-header">Danh sách đơn thuốc</div>
                        <div class="card-body">
                            <p class="text-muted">Danh sách đơn thuốc sẽ được hiển thị ở đây...</p>
                        </div>
                    </div>
                </div>

                <div id="prescription-create" class="tab-content">
                    <div class="card">
                        <div class="card-header">Tạo đơn thuốc mới</div>
                        <div class="card-body">
                            <p class="text-muted">Form tạo đơn thuốc sẽ được hiển thị ở đây...</p>
                        </div>
                    </div>
                </div>

                <div id="prescription-history" class="tab-content">
                    <div class="card">
                        <div class="card-header">Lịch sử kê đơn</div>
                        <div class="card-body">
                            <p class="text-muted">Lịch sử kê đơn sẽ được hiển thị ở đây...</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Invoices Section -->
            <div id="invoices" class="content-section">
                <div class="section-header">
                    <h2 class="section-title">
                        <i class="fas fa-file-invoice-dollar"></i>
                        Quản lý hóa đơn
                    </h2>
                </div>

                <div class="content-tabs">
                    <button class="tab-btn active" data-target="invoice-list">
                        <i class="fas fa-list"></i>
                        Tất cả hóa đơn
                    </button>
                    <button class="tab-btn" data-target="invoice-pending">
                        <i class="fas fa-hourglass-half"></i>
                        Chờ thanh toán
                    </button>
                    <button class="tab-btn" data-target="invoice-paid">
                        <i class="fas fa-check-circle"></i>
                        Đã thanh toán
                    </button>
                </div>

                <div id="invoice-list" class="tab-content active">
                    <div class="card">
                        <div class="card-header">Tất cả hóa đơn</div>
                        <div class="card-body">
                            <p class="text-muted">Danh sách hóa đơn sẽ được hiển thị ở đây...</p>
                        </div>
                    </div>
                </div>

                <div id="invoice-pending" class="tab-content">
                    <div class="card">
                        <div class="card-header">Hóa đơn chờ thanh toán</div>
                        <div class="card-body">
                            <p class="text-muted">Danh sách hóa đơn chờ thanh toán sẽ được hiển thị ở đây...</p>
                        </div>
                    </div>
                </div>

                <div id="invoice-paid" class="tab-content">
                    <div class="card">
                        <div class="card-header">Hóa đơn đã thanh toán</div>
                        <div class="card-body">
                            <p class="text-muted">Danh sách hóa đơn đã thanh toán sẽ được hiển thị ở đây...</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Suppliers Section -->
            <div id="suppliers" class="content-section">
                <div class="section-header">
                    <h2 class="section-title">
                        <i class="fas fa-truck"></i>
                        Quản lý nhà cung cấp
                    </h2>
                    <button class="action-btn btn-primary-custom">
                        <i class="fas fa-plus"></i>
                        Thêm NCC
                    </button>
                </div>

                <div class="content-tabs">
                    <button class="tab-btn active" data-target="supplier-list">
                        <i class="fas fa-list"></i>
                        Danh sách NCC
                    </button>
                    <button class="tab-btn" data-target="supplier-orders">
                        <i class="fas fa-shopping-cart"></i>
                        Đơn đặt hàng
                    </button>
                </div>

                <div id="supplier-list" class="tab-content active">
                    <div class="card">
                        <div class="card-header">Danh sách nhà cung cấp</div>
                        <div class="card-body">
                            <p class="text-muted">Danh sách nhà cung cấp sẽ được hiển thị ở đây...</p>
                        </div>
                    </div>
                </div>

                <div id="supplier-orders" class="tab-content">
                    <div class="card">
                        <div class="card-header">Đơn đặt hàng</div>
                        <div class="card-body">
                            <p class="text-muted">Danh sách đơn đặt hàng sẽ được hiển thị ở đây...</p>
                        </div>
                    </div>
                </div>
            </div>

            @if (userRole == "Admin")
            {
                <!-- Employees Section -->
                <div id="employees" class="content-section">
                    <div class="section-header">
                        <h2 class="section-title">
                            <i class="fas fa-users"></i>
                            Quản lý nhân viên
                        </h2>
                        <button class="action-btn btn-primary-custom">
                            <i class="fas fa-user-plus"></i>
                            Thêm nhân viên
                        </button>
                    </div>

                    <div class="content-tabs">
                        <button class="tab-btn active" data-target="employee-list">
                            <i class="fas fa-list"></i>
                            Danh sách nhân viên
                        </button>
                        <button class="tab-btn" data-target="employee-add">
                            <i class="fas fa-user-plus"></i>
                            Thêm nhân viên
                        </button>
                        <button class="tab-btn" data-target="employee-roles">
                            <i class="fas fa-user-shield"></i>
                            Phân quyền
                        </button>
                    </div>

                    <div id="employee-list" class="tab-content active">
                        <div class="card">
                            <div class="card-header">Danh sách nhân viên</div>
                            <div class="card-body">
                                <p class="text-muted">Danh sách nhân viên sẽ được hiển thị ở đây...</p>
                            </div>
                        </div>
                    </div>

                    <div id="employee-add" class="tab-content">
                        <div class="card">
                            <div class="card-header">Thêm nhân viên mới</div>
                            <div class="card-body">
                                <p class="text-muted">Form thêm nhân viên sẽ được hiển thị ở đây...</p>
                            </div>
                        </div>
                    </div>

                    <div id="employee-roles" class="tab-content">
                        <div class="card">
                            <div class="card-header">Quản lý phân quyền</div>
                            <div class="card-body">
                                <p class="text-muted">Giao diện phân quyền sẽ được hiển thị ở đây...</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Reports Section -->
                <div id="reports" class="content-section">
                    <div class="section-header">
                        <h2 class="section-title">
                            <i class="fas fa-chart-bar"></i>
                            Báo cáo & Thống kê
                        </h2>
                    </div>

                    <div class="content-tabs">
                        <button class="tab-btn active" data-target="report-revenue">
                            <i class="fas fa-dollar-sign"></i>
                            Doanh thu
                        </button>
                        <button class="tab-btn" data-target="report-inventory">
                            <i class="fas fa-warehouse"></i>
                            Tồn kho
                        </button>
                        <button class="tab-btn" data-target="report-usage">
                            <i class="fas fa-chart-line"></i>
                            Sử dụng
                        </button>
                    </div>

                    <div id="report-revenue" class="tab-content active">
                        <div class="card">
                            <div class="card-header">Báo cáo doanh thu</div>
                            <div class="card-body">
                                <p class="text-muted">Báo cáo doanh thu sẽ được hiển thị ở đây...</p>
                            </div>
                        </div>
                    </div>

                    <div id="report-inventory" class="tab-content">
                        <div class="card">
                            <div class="card-header">Báo cáo tồn kho</div>
                            <div class="card-body">
                                <p class="text-muted">Báo cáo tồn kho sẽ được hiển thị ở đây...</p>
                            </div>
                        </div>
                    </div>

                    <div id="report-usage" class="tab-content">
                        <div class="card">
                            <div class="card-header">Thống kê sử dụng</div>
                            <div class="card-body">
                                <p class="text-muted">Thống kê sử dụng sẽ được hiển thị ở đây...</p>
                            </div>
                        </div>
                    </div>
                </div>
            }

            <!-- Settings Section -->
            <div id="settings" class="content-section">
                <div class="section-header">
                    <h2 class="section-title">
                        <i class="fas fa-cog"></i>
                        Cài đặt
                    </h2>
                </div>

                <div class="content-tabs">
                    <button class="tab-btn active" data-target="settings-general">
                        <i class="fas fa-sliders-h"></i>
                        Cài đặt chung
                    </button>
                    <button class="tab-btn" data-target="settings-profile">
                        <i class="fas fa-user-circle"></i>
                        Hồ sơ cá nhân
                    </button>
                </div>

                <div id="settings-general" class="tab-content active">
                    <div class="card">
                        <div class="card-header">Cài đặt chung</div>
                        <div class="card-body">
                            <p class="text-muted">Các cài đặt chung của hệ thống sẽ được hiển thị ở đây...</p>
                        </div>
                    </div>
                </div>

                <div id="settings-profile" class="tab-content">
                    <div class="card">
                        <div class="card-header">Hồ sơ cá nhân</div>
                        <div class="card-body">
                            <p class="text-muted">Thông tin hồ sơ cá nhân sẽ được hiển thị ở đây...</p>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
</div>

@section Scripts {
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    
    <script>
        $(document).ready(function() {
            // Menu accordion functionality
            $('.menu-group-header').click(function() {
                const $header = $(this);
                const $group = $header.parent();
                const $submenu = $group.find('.menu-submenu');
                const section = $header.data('section');

                // Toggle submenu
                if ($submenu.length > 0) {
                    // Close other submenus
                    $('.menu-submenu').not($submenu).removeClass('show');
                    $('.menu-group-header').not($header).removeClass('active');
                    
                    // Toggle current submenu
                    $submenu.toggleClass('show');
                    $header.toggleClass('active');
                } else {
                    // If no submenu, it's a direct link (like Dashboard)
                    $('.menu-group-header').removeClass('active');
                    $header.addClass('active');
                    
                    // Show corresponding section
                    showSection(section);
                }
            });

            // Submenu item click
            $('.submenu-item').click(function(e) {
                e.preventDefault();
                e.stopPropagation();
                
                const $item = $(this);
                const section = $item.closest('.menu-group').find('.menu-group-header').data('section');
                const tab = $item.data('tab');
                
                // Update active states
                $('.submenu-item').removeClass('active');
                $item.addClass('active');
                
                // Show section and tab
                showSection(section);
                if (tab) {
                    switchTab(tab);
                }
            });

            // Tab switching
            $('.tab-btn').click(function() {
                const $btn = $(this);
                const target = $btn.data('target');
                const $container = $btn.closest('.content-section');
                
                // Update tab buttons
                $container.find('.tab-btn').removeClass('active');
                $btn.addClass('active');
                
                // Update tab contents
                $container.find('.tab-content').removeClass('active');
                $container.find('#' + target).addClass('active');
            });

            // Helper function to show section
            function showSection(sectionId) {
                $('.content-section').removeClass('active');
                $('#' + sectionId).addClass('active');
            }

            // Helper function to switch tab within a section
            function switchTab(tabId) {
                const $section = $('.content-section.active');
                $section.find('.tab-btn').removeClass('active');
                $section.find('.tab-content').removeClass('active');
                
                $section.find('.tab-btn[data-target="' + tabId + '"]').addClass('active');
                $section.find('#' + tabId).addClass('active');
            }

            // Initialize Charts
            initializeCharts();
        });

        // Chart initialization
        function initializeCharts() {
            // Revenue Chart
            const revenueCtx = document.getElementById('revenueChart');
            if (revenueCtx) {
                new Chart(revenueCtx, {
                    type: 'line',
                    data: {
                        labels: ['T2', 'T3', 'T4', 'T5', 'T6', 'T7', 'CN'],
                        datasets: [{
                            label: 'Doanh thu (triệu VNĐ)',
                            data: [12, 19, 15, 17, 22, 18, 14],
                            borderColor: '#1e3a5f',
                            backgroundColor: 'rgba(30, 58, 95, 0.1)',
                            tension: 0.4,
                            fill: true,
                            borderWidth: 3,
                            pointRadius: 5,
                            pointHoverRadius: 7,
                            pointBackgroundColor: '#1e3a5f',
                            pointBorderColor: '#fff',
                            pointBorderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            },
                            tooltip: {
                                mode: 'index',
                                intersect: false,
                                backgroundColor: 'rgba(30, 58, 95, 0.9)',
                                titleColor: '#fff',
                                bodyColor: '#fff',
                                borderColor: '#1e3a5f',
                                borderWidth: 1,
                                padding: 12,
                                displayColors: false,
                                callbacks: {
                                    label: function(context) {
                                        return 'Doanh thu: ' + context.parsed.y + ' triệu VNĐ';
                                    }
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: function(value) {
                                        return value + 'M';
                                    }
                                },
                                grid: {
                                    color: 'rgba(0, 0, 0, 0.05)'
                                }
                            },
                            x: {
                                grid: {
                                    display: false
                                }
                            }
                        },
                        interaction: {
                            mode: 'nearest',
                            axis: 'x',
                            intersect: false
                        }
                    }
                });
            }

            // Patient Chart
            const patientCtx = document.getElementById('patientChart');
            if (patientCtx) {
                new Chart(patientCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['BHYT', 'Viện phí', 'Khám sức khỏe'],
                        datasets: [{
                            data: [45, 35, 20],
                            backgroundColor: [
                                '#1e3a5f',
                                '#38ef7d',
                                '#f5576c'
                            ],
                            borderWidth: 0,
                            hoverOffset: 10
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    padding: 15,
                                    usePointStyle: true,
                                    font: {
                                        size: 12,
                                        weight: '500'
                                    }
                                }
                            },
                            tooltip: {
                                backgroundColor: 'rgba(30, 58, 95, 0.9)',
                                titleColor: '#fff',
                                bodyColor: '#fff',
                                borderColor: '#1e3a5f',
                                borderWidth: 1,
                                padding: 12,
                                displayColors: true,
                                callbacks: {
                                    label: function(context) {
                                        return context.label + ': ' + context.parsed + '%';
                                    }
                                }
                            }
                        }
                    }
                });
            }
        }
    </script>
}
