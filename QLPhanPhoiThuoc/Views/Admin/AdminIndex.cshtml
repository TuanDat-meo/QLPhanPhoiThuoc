@{
    ViewData["Title"] = "Trang quản trị";
    Layout = "~/Views/Shared/_Layout.cshtml";
    var chucVu = ViewBag.ChucVu ?? "Quản trị viên";
    var tenNhanVien = ViewBag.TenNhanVien ?? "Admin";
    var maNhanVien = ViewBag.MaNhanVien ?? "";
    var userRole = User.FindFirst(System.Security.Claims.ClaimTypes.Role)?.Value ?? "Admin";
}

<style>
    /* ==================== MODERN COMPACT SIDEBAR LAYOUT ==================== */
    
    .admin-container {
        display: flex;
        gap: 25px;
        min-height: calc(100vh - 200px);
        padding: 20px;
    }

    /* ==================== COMPACT SIDEBAR ==================== */
    .sidebar {
        width: 260px;
        background: white;
        border-radius: 12px;
        box-shadow: 0 2px 12px rgba(0,0,0,0.08);
        padding: 0;
        height: fit-content;
        max-height: calc(100vh - 140px);
        overflow-y: auto;
        position: sticky;
        top: 90px;
    }

    .sidebar::-webkit-scrollbar {
        width: 5px;
    }

    .sidebar::-webkit-scrollbar-track {
        background: #f1f1f1;
    }

    .sidebar::-webkit-scrollbar-thumb {
        background: #1e3a5f;
        border-radius: 10px;
    }

    .sidebar-header {
        padding: 20px;
        border-bottom: 1px solid #e9ecef;
        background: linear-gradient(135deg, #1e3a5f 0%, #0f2847 100%);
        border-radius: 12px 12px 0 0;
        color: white;
    }

    .sidebar-title {
        font-size: 1.1rem;
        font-weight: 700;
        margin: 0;
    }

    .sidebar-subtitle {
        font-size: 0.85rem;
        opacity: 0.9;
        margin-top: 3px;
    }

    /* Menu Accordion */
    .menu-accordion {
        padding: 10px 0;
    }

    .menu-group {
        margin-bottom: 5px;
    }

    .menu-group-header {
        padding: 12px 20px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: space-between;
        transition: all 0.3s ease;
        border-left: 3px solid transparent;
        color: #495057;
        font-weight: 500;
        user-select: none;
    }

    .menu-group-header:hover {
        background: #f8f9fa;
        color: #1e3a5f;
        border-left-color: #1e3a5f;
    }

    .menu-group-header.active {
        background: linear-gradient(90deg, rgba(30,58,95,0.1) 0%, transparent 100%);
        color: #1e3a5f;
        border-left-color: #1e3a5f;
        font-weight: 600;
    }

    .menu-header-content {
        display: flex;
        align-items: center;
        gap: 12px;
        flex: 1;
    }

    .menu-header-content i {
        width: 22px;
        text-align: center;
        font-size: 1.1rem;
    }

    .menu-arrow {
        transition: transform 0.3s ease;
        font-size: 0.85rem;
        color: #6c757d;
    }

    .menu-group-header.active .menu-arrow {
        transform: rotate(90deg);
        color: #1e3a5f;
    }

    /* Submenu */
    .menu-submenu {
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.3s ease;
        background: #f8f9fa;
    }

    .menu-submenu.show {
        max-height: 500px;
    }

    .submenu-item {
        padding: 10px 20px 10px 54px;
        color: #6c757d;
        text-decoration: none;
        display: flex;
        align-items: center;
        gap: 10px;
        transition: all 0.2s ease;
        border-left: 3px solid transparent;
        font-size: 0.9rem;
        cursor: pointer;
    }

    .submenu-item:hover {
        background: white;
        color: #1e3a5f;
        border-left-color: #38bdf8;
        text-decoration: none;
        padding-left: 58px;
    }

    .submenu-item.active {
        background: white;
        color: #1e3a5f;
        border-left-color: #1e3a5f;
        font-weight: 600;
    }

    .submenu-item i {
        font-size: 0.75rem;
        width: 12px;
    }

    .menu-badge {
        background: linear-gradient(135deg, #f5576c 0%, #f093fb 100%);
        color: white;
        font-size: 0.7rem;
        padding: 2px 8px;
        border-radius: 12px;
        font-weight: 600;
        margin-left: auto;
    }

    /* ==================== MAIN CONTENT AREA ==================== */
    .dashboard-content {
        flex: 1;
        min-width: 0;
        position: relative;
    }

    /* Content Section */
    .content-section {
        display: none;
    }

    .content-section.active {
        display: block;
        animation: fadeIn 0.3s ease;
    }

    @@keyframes fadeIn {
        from {
            opacity: 0;
            transform: translateY(10px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    /* ==================== PANEL SYSTEM ==================== */
    .panel-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        z-index: 1000;
        display: none;
        animation: fadeInOverlay 0.3s ease;
    }

    .panel-overlay.show {
        display: block;
    }

    @@keyframes fadeInOverlay {
        from { opacity: 0; }
        to { opacity: 1; }
    }

    .panel-container {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        margin: auto;
        width: 85%;
        max-width: 1200px;
        height: 90vh; 

        background: white;
        box-shadow: 0 0 20px rgba(0, 0, 0, 0.2);
        z-index: 1001;
        display: flex;
        flex-direction: column;
    }

    .panel-container.show {

    }

    .panel-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 10px 20px;
        background: linear-gradient(135deg, #1e3a5f 0%, #0f2847 100%);
        color: white;
        border-bottom: 3px solid #38bdf8;
    }

    .panel-title {
        display: flex;
        align-items: center;
        gap: 15px;
        margin: 0;
        font-size: 1.5rem;
        font-weight: 700;
    }

    .panel-title i {
        font-size: 1.8rem;
    }

    .panel-close-btn {
        background: rgba(255, 255, 255, 0.2);
        border: none;
        color: white;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
        font-size: 1.2rem;
    }

    .panel-close-btn:hover {
        background: rgba(255, 255, 255, 0.3);
        transform: rotate(90deg);
    }

    .panel-body {
        flex: 1;
        overflow-y: auto;
        padding: 10px;
        background: #f8f9fa;
    }

    .panel-body::-webkit-scrollbar {
        width: 8px;
    }

    .panel-body::-webkit-scrollbar-track {
        background: #f1f1f1;
    }

    .panel-body::-webkit-scrollbar-thumb {
        background: #1e3a5f;
        border-radius: 10px;
    }

    .panel-body::-webkit-scrollbar-thumb:hover {
        background: #0f2847;
    }

    /* Panel Stacking - để có thể mở nhiều panel cùng lúc */
    .panel-overlay[data-level="1"] {
        z-index: 1000;
    }

    .panel-container[data-level="1"] {
        z-index: 1001;
    }

    .panel-overlay[data-level="2"] {
        z-index: 1002;
    }

    .panel-container[data-level="2"] {
        z-index: 1003;
        width: 80%;
    }

    .panel-overlay[data-level="3"] {
        z-index: 1004;
    }

    .panel-container[data-level="3"] {
        z-index: 1005;
        width: 75%;
    }

    /* Loading Spinner */
    .loading-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(255, 255, 255, 0.9);
        z-index: 9999;
        justify-content: center;
        align-items: center;
    }

    .loading-overlay.show {
        display: flex;
    }

    .spinner {
        border: 4px solid #f3f3f3;
        border-top: 4px solid #1e3a5f;
        border-radius: 50%;
        width: 50px;
        height: 50px;
        animation: spin 1s linear infinite;
    }

    @@keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    /* CSS từ Index.cshtml cho phần quản lý thuốc */
    .medicine-container {
        padding: 25px;
        background: #f8f9fa;
        min-height: calc(100vh - 200px);
    }

    .page-header {
        background: linear-gradient(135deg, #1e3a5f 0%, #0f2847 100%);
        color: white;
        padding: 25px 30px;
        border-radius: 12px;
        margin-bottom: 25px;
        box-shadow: 0 4px 15px rgba(30, 58, 95, 0.3);
    }

    /* Responsive */
    @@media (max-width: 1200px) {
        .panel-container {
            width: 90%;
        }
    }

    @@media (max-width: 768px) {
        .admin-container {
            flex-direction: column;
        }

        .sidebar {
            width: 100%;
            position: relative;
            top: 0;
        }

        .panel-container {
            width: 100%;
            max-width: 100%;
        }

        .panel-container[data-level="2"],
        .panel-container[data-level="3"] {
            width: 100%;
        }
    }
</style>

<!-- Loading Overlay -->
<div id="loadingOverlay" class="loading-overlay">
    <div class="spinner"></div>
</div>

<div class="admin-container">
    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <h3 class="sidebar-title">
                <i class="fas fa-user-circle"></i> @tenNhanVien
            </h3>
            <div class="sidebar-subtitle">@chucVu</div>
        </div>

        <nav class="menu-accordion">
            <!-- Dashboard -->
            <div class="menu-group">
                <div class="menu-group-header active" data-section="dashboard">
                    <div class="menu-header-content">
                        <i class="fas fa-th-large"></i>
                        <span>Dashboard</span>
                    </div>
                </div>
            </div>

            <!-- Quản lý thuốc -->
            <div class="menu-group">
                <div class="menu-group-header" data-section="medicines">
                    <div class="menu-header-content">
                        <i class="fas fa-pills"></i>
                        <span>Quản lý thuốc</span>
                    </div>
                    <i class="fas fa-chevron-right menu-arrow"></i>
                </div>
                <div class="menu-submenu">
                    <a href="#" class="submenu-item" data-url="/Admin/Thuoc/Index">
                        <i class="fas fa-circle"></i>
                        <span>Danh sách thuốc</span>
                    </a>
                    <a href="#" class="submenu-item" data-url="/Admin/Thuoc/TonKho">
                        <i class="fas fa-circle"></i>
                        <span>Tồn kho</span>
                    </a>
                    <a href="#" class="submenu-item" data-url="/Admin/Thuoc/CanhBao">
                        <i class="fas fa-circle"></i>
                        <span>Cảnh báo</span>
                    </a>
                    <a href="#" class="submenu-item" data-url="/Admin/Thuoc/ThongKe">
                        <i class="fas fa-circle"></i>
                        <span>Thống kê</span>
                    </a>
                </div>
            </div>

            <!-- Bệnh nhân -->
            <div class="menu-group">
                <div class="menu-group-header" data-section="patients">
                    <div class="menu-header-content">
                        <i class="fas fa-user-injured"></i>
                        <span>Bệnh nhân</span>
                    </div>
                    <i class="fas fa-chevron-right menu-arrow"></i>
                </div>
                <div class="menu-submenu">
                    <a href="#" class="submenu-item" data-tab="patient-list">
                        <i class="fas fa-circle"></i>
                        <span>Danh sách bệnh nhân</span>
                    </a>
                    <a href="#" class="submenu-item" data-tab="patient-add">
                        <i class="fas fa-circle"></i>
                        <span>Thêm bệnh nhân</span>
                    </a>
                </div>
            </div>

            <!-- Đơn thuốc -->
            <div class="menu-group">
                <div class="menu-group-header" data-section="prescriptions">
                    <div class="menu-header-content">
                        <i class="fas fa-prescription"></i>
                        <span>Đơn thuốc</span>
                    </div>
                    <i class="fas fa-chevron-right menu-arrow"></i>
                </div>
                <div class="menu-submenu">
                    <a href="#" class="submenu-item" data-tab="prescription-list">
                        <i class="fas fa-circle"></i>
                        <span>Danh sách đơn</span>
                    </a>
                    <a href="#" class="submenu-item" data-tab="prescription-pending">
                        <i class="fas fa-circle"></i>
                        <span>Chờ cấp phát</span>
                    </a>
                    <a href="#" class="submenu-item" data-tab="prescription-completed">
                        <i class="fas fa-circle"></i>
                        <span>Đã hoàn thành</span>
                    </a>
                </div>
            </div>

            <!-- Kho -->
            <div class="menu-group">
                <div class="menu-group-header" data-section="warehouse">
                    <div class="menu-header-content">
                        <i class="fas fa-warehouse"></i>
                        <span>Quản lý kho</span>
                    </div>
                    <i class="fas fa-chevron-right menu-arrow"></i>
                </div>
                <div class="menu-submenu">
                    <a href="#" class="submenu-item" data-tab="warehouse-list">
                        <i class="fas fa-circle"></i>
                        <span>Danh sách kho</span>
                    </a>
                    <a href="#" class="submenu-item" data-tab="warehouse-import">
                        <i class="fas fa-circle"></i>
                        <span>Phiếu nhập</span>
                    </a>
                    <a href="#" class="submenu-item" data-tab="warehouse-export">
                        <i class="fas fa-circle"></i>
                        <span>Phiếu xuất</span>
                    </a>
                </div>
            </div>

            <!-- Hóa đơn -->
            <div class="menu-group">
                <div class="menu-group-header" data-section="invoices">
                    <div class="menu-header-content">
                        <i class="fas fa-file-invoice-dollar"></i>
                        <span>Hóa đơn</span>
                    </div>
                    <i class="fas fa-chevron-right menu-arrow"></i>
                </div>
                <div class="menu-submenu">
                    <a href="#" class="submenu-item" data-tab="invoice-list">
                        <i class="fas fa-circle"></i>
                        <span>Danh sách hóa đơn</span>
                    </a>
                    <a href="#" class="submenu-item" data-tab="invoice-pending">
                        <i class="fas fa-circle"></i>
                        <span>Chờ thanh toán</span>
                    </a>
                    <a href="#" class="submenu-item" data-tab="invoice-paid">
                        <i class="fas fa-circle"></i>
                        <span>Đã thanh toán</span>
                    </a>
                </div>
            </div>

            <!-- Nhà cung cấp -->
            <div class="menu-group">
                <div class="menu-group-header" data-section="suppliers">
                    <div class="menu-header-content">
                        <i class="fas fa-truck"></i>
                        <span>Nhà cung cấp</span>
                    </div>
                    <i class="fas fa-chevron-right menu-arrow"></i>
                </div>
                <div class="menu-submenu">
                    <a href="#" class="submenu-item" data-tab="supplier-list">
                        <i class="fas fa-circle"></i>
                        <span>Danh sách NCC</span>
                    </a>
                    <a href="#" class="submenu-item" data-tab="supplier-orders">
                        <i class="fas fa-circle"></i>
                        <span>Đơn đặt hàng</span>
                    </a>
                </div>
            </div>

            @if (userRole == "Admin")
            {
                <!-- Nhân viên (chỉ Admin) -->
                <div class="menu-group">
                    <div class="menu-group-header" data-section="employees">
                        <div class="menu-header-content">
                            <i class="fas fa-users"></i>
                            <span>Nhân viên</span>
                        </div>
                        <i class="fas fa-chevron-right menu-arrow"></i>
                    </div>
                    <div class="menu-submenu">
                        <a href="#" class="submenu-item" data-tab="employee-list">
                            <i class="fas fa-circle"></i>
                            <span>Danh sách nhân viên</span>
                        </a>
                        <a href="#" class="submenu-item" data-tab="employee-add">
                            <i class="fas fa-circle"></i>
                            <span>Thêm nhân viên</span>
                        </a>
                        <a href="#" class="submenu-item" data-tab="employee-roles">
                            <i class="fas fa-circle"></i>
                            <span>Phân quyền</span>
                        </a>
                    </div>
                </div>

                <!-- Báo cáo -->
                <div class="menu-group">
                    <div class="menu-group-header" data-section="reports">
                        <div class="menu-header-content">
                            <i class="fas fa-chart-bar"></i>
                            <span>Báo cáo</span>
                        </div>
                        <i class="fas fa-chevron-right menu-arrow"></i>
                    </div>
                    <div class="menu-submenu">
                        <a href="#" class="submenu-item" data-tab="report-revenue">
                            <i class="fas fa-circle"></i>
                            <span>Báo cáo doanh thu</span>
                        </a>
                        <a href="#" class="submenu-item" data-tab="report-inventory">
                            <i class="fas fa-circle"></i>
                            <span>Báo cáo tồn kho</span>
                        </a>
                        <a href="#" class="submenu-item" data-tab="report-usage">
                            <i class="fas fa-circle"></i>
                            <span>Thống kê sử dụng</span>
                        </a>
                    </div>
                </div>
            }

            <!-- Cài đặt -->
            <div class="menu-group">
                <div class="menu-group-header" data-section="settings">
                    <div class="menu-header-content">
                        <i class="fas fa-cog"></i>
                        <span>Cài đặt</span>
                    </div>
                    <i class="fas fa-chevron-right menu-arrow"></i>
                </div>
                <div class="menu-submenu">
                    <a href="#" class="submenu-item" data-tab="settings-general">
                        <i class="fas fa-circle"></i>
                        <span>Cài đặt chung</span>
                    </a>
                    <a href="#" class="submenu-item" data-tab="settings-profile">
                        <i class="fas fa-circle"></i>
                        <span>Hồ sơ cá nhân</span>
                    </a>
                </div>
            </div>
        </nav>
    </aside>

    <!-- Main Content -->
    <main class="dashboard-content">
        <!-- Dashboard Section (Default) -->
        <div id="dashboard" class="content-section active">
            <h2>Đang tải...</h2>
        </div>

        <!-- Medicine Management Section -->
        <div id="medicines" class="content-section">
            <div class="medicine-container">
                <div class="page-header">
                    <h2 style="margin: 0; font-size: 1.8rem; font-weight: 700;">Quản lý thuốc</h2>
                    <p style="margin: 5px 0 0 0; opacity: 0.9; font-size: 0.95rem;">Quản lý thông tin thuốc trong hệ thống</p>
                </div>
                <div id="medicineContent">
                    <p style="text-align: center; padding: 50px; color: #6c757d;">Chọn một mục từ menu bên trái</p>
                </div>
            </div>
        </div>
    </main>
</div>

@section Scripts {
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    // ==================== PANEL MANAGEMENT SYSTEM ====================
    let panelStack = [];
    let currentPanelLevel = 0;

    // Mở panel mới
    function openPanel(url, title, icon = 'fas fa-file') {
        currentPanelLevel++;
        
        const panelId = 'panel-' + currentPanelLevel;
        const overlayId = 'overlay-' + currentPanelLevel;
        
        // Tạo overlay
        const overlay = $('<div>', {
            id: overlayId,
            class: 'panel-overlay',
            'data-level': currentPanelLevel
        });
        
        // Tạo panel container
        const panel = $('<div>', {
            id: panelId,
            class: 'panel-container',
            'data-level': currentPanelLevel
        });
        
        // Tạo panel header
        const header = $(`
            <div class="panel-header">
                <h4 class="panel-title">
                    <i class="${icon}"></i>
                    <span>${title}</span>
                </h4>
                <button class="panel-close-btn" onclick="closePanel(${currentPanelLevel})">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        `);
        
        // Tạo panel body
        const body = $('<div>', {
            class: 'panel-body'
        }).html('<div style="text-align: center; padding: 50px;"><div class="spinner"></div></div>');
        
        panel.append(header).append(body);
        
        // Thêm vào DOM
        $('body').append(overlay).append(panel);
        
        // Đóng panel khi click overlay
        overlay.on('click', function() {
            closePanel(currentPanelLevel);
        });
        
        // Hiển thị panel với animation
        setTimeout(() => {
            overlay.addClass('show');
            panel.addClass('show');
        }, 10);
        
        // Load nội dung
        $.ajax({
            url: url,
            method: 'GET',
            headers: {
                'X-Requested-With': 'XMLHttpRequest'
            },
            success: function(data) {
                body.html(data);
            },
            error: function(xhr, status, error) {
                body.html(`<div class="alert alert-danger">Lỗi khi tải nội dung: ${error}</div>`);
            }
        });
        
        // Thêm vào stack
        panelStack.push({
            id: panelId,
            overlayId: overlayId,
            level: currentPanelLevel
        });
        
        return currentPanelLevel;
    }

    // Đóng panel
    function closePanel(level) {
        const panelData = panelStack.find(p => p.level === level);
        
        if (!panelData) return;
        
        const panel = $('#' + panelData.id);
        const overlay = $('#' + panelData.overlayId);
        
        // Ẩn với animation
        panel.removeClass('show');
        overlay.removeClass('show');
        
        // Xóa khỏi DOM sau animation
        setTimeout(() => {
            panel.remove();
            overlay.remove();
        }, 400);
        
        // Xóa khỏi stack
        panelStack = panelStack.filter(p => p.level !== level);
        
        // Cập nhật current level
        if (panelStack.length > 0) {
            currentPanelLevel = Math.max(...panelStack.map(p => p.level));
        } else {
            currentPanelLevel = 0;
        }
    }

    // Đóng tất cả panel
    function closeAllPanels() {
        while (panelStack.length > 0) {
            closePanel(panelStack[panelStack.length - 1].level);
        }
    }

    // ==================== GLOBAL FUNCTIONS FOR VIEWS ====================
    
    // Hàm load Details trong panel
    function loadThuocDetailsPanel(maThuoc) {
        openPanel(
            `/Admin/Thuoc/Details/${maThuoc}`,
            'Chi tiết thuốc',
            'fas fa-pills'
        );
    }

    // Hàm load Edit trong panel
    function loadThuocEditPanel(maThuoc) {
        openPanel(
            `/Admin/Thuoc/Edit/${maThuoc}`,
            'Chỉnh sửa thuốc',
            'fas fa-edit'
        );
    }

    // Hàm load PhieuNhap trong panel
    function loadPhieuNhapPanel() {
        openPanel(
            '/Admin/PhieuNhap/Create',
            'Tạo phiếu nhập',
            'fas fa-file-import'
        );
    }

    // Hàm tương thích ngược - redirect sang panel
    function loadThuocContent(url) {
        // Nếu là Details hoặc Edit, mở trong panel
        if (url.includes('/Details/')) {
            const maThuoc = url.split('/Details/')[1];
            loadThuocDetailsPanel(maThuoc);
        } else if (url.includes('/Edit/')) {
            const maThuoc = url.split('/Edit/')[1];
            loadThuocEditPanel(maThuoc);
        } else if (url.includes('/PhieuNhap/')) {
            loadPhieuNhapPanel();
        } else {
            // Các trang khác load bình thường
            showLoading();
            showSection('medicines');
            
            $.ajax({
                url: url,
                method: 'GET',
                headers: {
                    'X-Requested-With': 'XMLHttpRequest'
                },
                success: function(data) {
                    $('#medicineContent').html(data);
                    hideLoading();
                },
                error: function(xhr, status, error) {
                    console.error('Error loading content:', error);
                    $('#medicineContent').html('<div class="alert alert-danger">Lỗi khi tải nội dung: ' + error + '</div>');
                    hideLoading();
                }
            });
        }
    }

    // ==================== MENU & NAVIGATION ====================
    
    $(document).ready(function() {
        // Load dashboard khi trang được tải
        loadDashboard();

        // Menu accordion functionality
        $('.menu-group-header').click(function() {
            const $header = $(this);
            const $group = $header.parent();
            const $submenu = $group.find('.menu-submenu');
            const section = $header.data('section');

            // Toggle submenu nếu có
            if ($submenu.length > 0) {
                // Close other submenus
                $('.menu-submenu').not($submenu).removeClass('show');
                $('.menu-group-header').not($header).removeClass('active');
                
                // Toggle current submenu
                $submenu.toggleClass('show');
                $header.toggleClass('active');
            } else {
                // If no submenu, it's a direct link (like Dashboard)
                $('.menu-group-header').removeClass('active');
                $('.submenu-item').removeClass('active');
                $header.addClass('active');
                
                // Show corresponding section
                if (section === 'dashboard') {
                    loadDashboard();
                }
            }
        });

        // Submenu item click
        $('.submenu-item').click(function(e) {
            e.preventDefault();
            
            const $item = $(this);
            const url = $item.data('url');
            
            // Update active states
            $('.submenu-item').removeClass('active');
            $item.addClass('active');
            
            // Ensure parent section is active
            const $header = $item.closest('.menu-group').find('.menu-group-header');
            $('.menu-group-header').removeClass('active');
            $header.addClass('active');

            // Load content nếu có URL
            if (url) {
                loadThuocContent(url);
                loadPatientsContent(url);
            }
        });

        // Đóng panel khi nhấn ESC
        $(document).keydown(function(e) {
            if (e.key === 'Escape' && panelStack.length > 0) {
                closePanel(panelStack[panelStack.length - 1].level);
            }
        });
    });

    // Helper function to show section
    function showSection(sectionId) {
        $('.content-section').removeClass('active');
        $('#' + sectionId).addClass('active');
    }

    // Load Dashboard
    function loadDashboard() {
        showLoading();
        showSection('dashboard');
        closeAllPanels(); // Đóng tất cả panels khi chuyển về dashboard
        
        $.ajax({
            url: '/Admin/Dashboard',
            method: 'GET',
            headers: {
                'X-Requested-With': 'XMLHttpRequest'
            },
            success: function(data) {
                $('#dashboard').html(data);
                hideLoading();
                
                // Re-initialize charts after loading dashboard
                setTimeout(initializeCharts, 100);
            },
            error: function(xhr, status, error) {
                console.error('Error loading dashboard:', error);
                $('#dashboard').html('<div class="alert alert-danger">Lỗi khi tải dashboard</div>');
                hideLoading();
            }
        });
    }

<<<<<<< HEAD
=======
    // Load Thuoc Content (Index, TonKho, ThongKe, CanhBao) - GLOBAL FUNCTION
    function loadThuocContent(url) {
        showLoading();
        showSection('medicines');
        
        $.ajax({
            url: url,
            method: 'GET',
            headers: {
                'X-Requested-With': 'XMLHttpRequest'
            },
            success: function(data) {
                $('#medicineContent').html(data);
                hideLoading();
            },
            error: function(xhr, status, error) {
                console.error('Error loading content:', error);
                $('#medicineContent').html('<div class="alert alert-danger">Lỗi khi tải nội dung: ' + error + '</div>');
                hideLoading();
            }
        });
    }

        function loadPatientsContent(url) {
            showLoading();
                showSection('patients');

            $.ajax({
                url: url,
                method: 'GET',
                headers: {
                    'X-Requested-With': 'XMLHttpRequest'
                },
                success: function(data) {
                    $('#patientsContent').html(data);
                    hideLoading();
                },
                error: function(xhr, status, error) {
                    console.error('Error loading content:', error);
                    $('#patientsContent').html('<div class="alert alert-danger">Lỗi khi tải nội dung: ' + error + '</div>');
                    hideLoading();
                }
            });
        }

>>>>>>> origin/main
    // Loading functions
    function showLoading() {
        $('#loadingOverlay').addClass('show');
    }

    function hideLoading() {
        $('#loadingOverlay').removeClass('show');
    }

    // Chart initialization
    function initializeCharts() {
        console.log('Charts initialized');
    }
</script>
}
