@{
    ViewData["Title"] = "Trang qu·∫£n tr·ªã";
    Layout = "~/Views/Shared/_Layout.cshtml";
    var chucVu = ViewBag.ChucVu ?? "Qu·∫£n tr·ªã vi√™n";
    var tenNhanVien = ViewBag.TenNhanVien ?? "Admin";
    var maNhanVien = ViewBag.MaNhanVien ?? "";
    var userRole = User.FindFirst(System.Security.Claims.ClaimTypes.Role)?.Value ?? "Admin";
}

<style>
    /* ==================== MODERN COMPACT SIDEBAR LAYOUT ==================== */

    .admin-container {
        display: flex;
        gap: 25px;
        min-height: calc(100vh - 200px);
        padding: 20px;
    }

    /* ==================== COMPACT SIDEBAR ==================== */
    .sidebar {
        width: 260px;
        background: white;
        border-radius: 12px;
        box-shadow: 0 2px 12px rgba(0,0,0,0.08);
        padding: 0;
        height: fit-content;
        max-height: calc(100vh - 140px);
        overflow-y: auto;
        position: sticky;
        top: 90px;
    }

        .sidebar::-webkit-scrollbar {
            width: 5px;
        }

        .sidebar::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        .sidebar::-webkit-scrollbar-thumb {
            background: #1e3a5f;
            border-radius: 10px;
        }

    .sidebar-header {
        padding: 20px;
        border-bottom: 1px solid #e9ecef;
        background: linear-gradient(135deg, #1e3a5f 0%, #0f2847 100%);
        border-radius: 12px 12px 0 0;
        color: white;
    }

    .sidebar-title {
        font-size: 1.1rem;
        font-weight: 700;
        margin: 0;
    }

    .sidebar-subtitle {
        font-size: 0.85rem;
        opacity: 0.9;
        margin-top: 3px;
    }

    /* Menu Accordion */
    .menu-accordion {
        padding: 10px 0;
    }

    .menu-group {
        margin-bottom: 5px;
    }

    .menu-group-header {
        padding: 12px 20px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: space-between;
        transition: all 0.3s ease;
        border-left: 3px solid transparent;
        color: #495057;
        font-weight: 500;
        user-select: none;
    }

        .menu-group-header:hover {
            background: #f8f9fa;
            color: #1e3a5f;
            border-left-color: #1e3a5f;
        }

        .menu-group-header.active {
            background: linear-gradient(90deg, rgba(30,58,95,0.1) 0%, transparent 100%);
            color: #1e3a5f;
            border-left-color: #1e3a5f;
            font-weight: 600;
        }

    .menu-header-content {
        display: flex;
        align-items: center;
        gap: 12px;
        flex: 1;
    }

        .menu-header-content i {
            width: 22px;
            text-align: center;
            font-size: 1.1rem;
        }

    .menu-arrow {
        transition: transform 0.3s ease;
        font-size: 0.85rem;
        color: #6c757d;
    }

    .menu-group-header.active .menu-arrow {
        transform: rotate(90deg);
        color: #1e3a5f;
    }

    /* Submenu */
    .menu-submenu {
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.3s ease;
        background: #f8f9fa;
    }

        .menu-submenu.show {
            max-height: 500px;
        }

    .submenu-item {
        padding: 10px 20px 10px 54px;
        color: #6c757d;
        text-decoration: none;
        display: flex;
        align-items: center;
        gap: 10px;
        transition: all 0.2s ease;
        border-left: 3px solid transparent;
        font-size: 0.9rem;
        cursor: pointer;
    }

        .submenu-item:hover {
            background: white;
            color: #1e3a5f;
            border-left-color: #38bdf8;
            text-decoration: none;
            padding-left: 58px;
        }

        .submenu-item.active {
            background: white;
            color: #1e3a5f;
            border-left-color: #1e3a5f;
            font-weight: 600;
        }

        .submenu-item i {
            font-size: 0.75rem;
            width: 12px;
        }

    .menu-badge {
        background: linear-gradient(135deg, #f5576c 0%, #f093fb 100%);
        color: white;
        font-size: 0.7rem;
        padding: 2px 8px;
        border-radius: 12px;
        font-weight: 600;
        margin-left: auto;
    }

    /* ==================== MAIN CONTENT AREA ==================== */
    .dashboard-content {
        flex: 1;
        min-width: 0;
        position: relative;
    }

    /* Content Section */
    .content-section {
        display: none;
    }

        .content-section.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

    @@keyframes fadeIn {
        from {
            opacity: 0;
            transform: translateY(10px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    /* ==================== PANEL SYSTEM ==================== */
    .panel-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        z-index: 1000;
        display: none;
        animation: fadeInOverlay 0.3s ease;
    }

        .panel-overlay.show {
            display: block;
        }

    @@keyframes fadeInOverlay {
        from {
            opacity: 0;
        }

        to {
            opacity: 1;
        }
    }

    .panel-container {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        margin: auto;
        width: 85%;
        max-width: 1200px;
        height: 90vh;
        background: white;
        box-shadow: 0 0 20px rgba(0, 0, 0, 0.2);
        z-index: 1001;
        display: flex;
        flex-direction: column;
    }

        .panel-container.show {
        }

    .panel-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 10px 20px;
        background: linear-gradient(135deg, #1e3a5f 0%, #0f2847 100%);
        color: white;
        border-bottom: 3px solid #38bdf8;
    }

    .panel-title {
        display: flex;
        align-items: center;
        gap: 15px;
        margin: 0;
        font-size: 1.5rem;
        font-weight: 700;
    }

        .panel-title i {
            font-size: 1.8rem;
        }

    .panel-close-btn {
        background: rgba(255, 255, 255, 0.2);
        border: none;
        color: white;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
        font-size: 1.2rem;
    }

        .panel-close-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: rotate(90deg);
        }

    .panel-body {
        flex: 1;
        overflow-y: auto;
        padding: 10px;
        background: #f8f9fa;
    }

        .panel-body::-webkit-scrollbar {
            width: 8px;
        }

        .panel-body::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        .panel-body::-webkit-scrollbar-thumb {
            background: #1e3a5f;
            border-radius: 10px;
        }

            .panel-body::-webkit-scrollbar-thumb:hover {
                background: #0f2847;
            }

    /* Panel Stacking - ƒë·ªÉ c√≥ th·ªÉ m·ªü nhi·ªÅu panel c√πng l√∫c */
    .panel-overlay[data-level="1"] {
        z-index: 1000;
    }

    .panel-container[data-level="1"] {
        z-index: 1001;
    }

    .panel-overlay[data-level="2"] {
        z-index: 1002;
    }

    .panel-container[data-level="2"] {
        z-index: 1003;
        width: 80%;
    }

    .panel-overlay[data-level="3"] {
        z-index: 1004;
    }

    .panel-container[data-level="3"] {
        z-index: 1005;
        width: 75%;
    }

    /* Loading Spinner */
    .loading-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(255, 255, 255, 0.9);
        z-index: 9999;
        justify-content: center;
        align-items: center;
    }

        .loading-overlay.show {
            display: flex;
        }

    .spinner {
        border: 4px solid #f3f3f3;
        border-top: 4px solid #1e3a5f;
        border-radius: 50%;
        width: 50px;
        height: 50px;
        animation: spin 1s linear infinite;
    }

    @@keyframes spin {
        0% {
            transform: rotate(0deg);
        }

        100% {
            transform: rotate(360deg);
        }
    }

    /* CSS t·ª´ Index.cshtml cho ph·∫ßn qu·∫£n l√Ω thu·ªëc */
    .medicine-container {
        padding: 25px;
        background: #f8f9fa;
        min-height: calc(100vh - 200px);
    }

    .page-header {
        background: linear-gradient(135deg, #1e3a5f 0%, #0f2847 100%);
        color: white;
        padding: 25px 30px;
        border-radius: 12px;
        margin-bottom: 25px;
        box-shadow: 0 4px 15px rgba(30, 58, 95, 0.3);
    }

    /* Responsive */
    @@media (max-width: 1200px) {
        .panel-container {
            width: 90%;
        }
    }

    @@media (max-width: 768px) {
        .admin-container {
            flex-direction: column;
        }

        .sidebar {
            width: 100%;
            position: relative;
            top: 0;
        }

        .panel-container {
            width: 100%;
            max-width: 100%;
        }

            .panel-container[data-level="2"],
            .panel-container[data-level="3"] {
                width: 100%;
            }
    }
</style>

<!-- Loading Overlay -->
<div id="loadingOverlay" class="loading-overlay">
    <div class="spinner"></div>
</div>

<div class="admin-container">
    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <h3 class="sidebar-title">
                <i class="fas fa-user-circle"></i> @tenNhanVien
            </h3>
            <div class="sidebar-subtitle">@chucVu</div>
        </div>

        <nav class="menu-accordion">
            <!-- Dashboard -->
            <div class="menu-group">
                <div class="menu-group-header active" data-section="dashboard">
                    <div class="menu-header-content">
                        <i class="fas fa-th-large"></i>
                        <span>Dashboard</span>
                    </div>
                </div>
            </div>

            <!-- Qu·∫£n l√Ω thu·ªëc -->
            <div class="menu-group">
                <div class="menu-group-header" data-section="medicines">
                    <div class="menu-header-content">
                        <i class="fas fa-pills"></i>
                        <span>Qu·∫£n l√Ω thu·ªëc</span>
                    </div>
                    <i class="fas fa-chevron-right menu-arrow"></i>
                </div>
                <div class="menu-submenu">
                    <a href="#" class="submenu-item" data-url="/Admin/Thuoc/Index">
                        <i class="fas fa-circle"></i>
                        <span>Danh s√°ch thu·ªëc</span>
                    </a>
                    <a href="#" class="submenu-item" data-url="/Admin/Thuoc/TonKho">
                        <i class="fas fa-circle"></i>
                        <span>T·ªìn kho</span>
                    </a>
                    <a href="#" class="submenu-item" data-url="/Admin/Thuoc/CanhBao">
                        <i class="fas fa-circle"></i>
                        <span>C·∫£nh b√°o</span>
                    </a>
                    <a href="#" class="submenu-item" data-url="/Admin/Thuoc/ThongKe">
                        <i class="fas fa-circle"></i>
                        <span>Th·ªëng k√™</span>
                    </a>
                </div>
            </div>

            <!-- B·ªánh nh√¢n -->
            <div class="menu-group">
                <div class="menu-group-header" data-section="patients">
                    <div class="menu-header-content">
                        <i class="fas fa-user-injured"></i>
                        <span>B·ªánh nh√¢n</span>
                    </div>
                    <i class="fas fa-chevron-right menu-arrow"></i>
                </div>
                <div class="menu-submenu">
                    <a class="submenu-item" data-url="/BenhNhan/_DSBenhNhan">
                        <i class="fas fa-circle"></i>
                        Danh s√°ch b·ªánh nh√¢n
                    </a>
                    <a class="submenu-item" data-url="/BenhNhan/_BenhNhan">
                        <i class="fas fa-circle"></i>
                        Qu·∫£n l√Ω b·ªánh nh√¢n
                    </a>
                    <a class="submenu-item" data-url="/BenhNhan/_BenhAnBenhNhan">
                        <i class="fas fa-circle"></i>
                        H·ªì s∆° b·ªánh √°n
                    </a>
                </div>
            </div>

            <!-- ƒê∆°n thu·ªëc -->
            <div class="menu-group">
                <div class="menu-group-header" data-section="prescriptions">
                    <div class="menu-header-content">
                        <i class="fas fa-prescription"></i>
                        <span>ƒê∆°n thu·ªëc</span>
                    </div>
                    <i class="fas fa-chevron-right menu-arrow"></i>
                </div>
                <div class="menu-submenu">
                    <a href="#" class="submenu-item" data-tab="prescription-list">
                        <i class="fas fa-circle"></i>
                        <span>Danh s√°ch ƒë∆°n</span>
                    </a>
                    <a href="#" class="submenu-item" data-tab="prescription-pending">
                        <i class="fas fa-circle"></i>
                        <span>Ch·ªù c·∫•p ph√°t</span>
                    </a>
                    <a href="#" class="submenu-item" data-tab="prescription-completed">
                        <i class="fas fa-circle"></i>
                        <span>ƒê√£ ho√†n th√†nh</span>
                    </a>
                </div>
            </div>

            <!-- Kho -->
            <div class="menu-group">
                <div class="menu-group-header" data-section="warehouse">
                    <div class="menu-header-content">
                        <i class="fas fa-warehouse"></i>
                        <span>Qu·∫£n l√Ω kho</span>
                    </div>
                    <i class="fas fa-chevron-right menu-arrow"></i>
                </div>
                <div class="menu-submenu">
                    <a href="javascript:void(0)" class="submenu-item" data-url="/Admin/Kho/Index">
                        <i class="fas fa-circle"></i>
                        <span>Danh s√°ch kho</span>
                    </a>
                </div>
            </div>

            <!-- H√≥a ƒë∆°n -->
            <div class="menu-group">
                <div class="menu-group-header" data-section="invoices">
                    <div class="menu-header-content">
                        <i class="fas fa-file-invoice-dollar"></i>
                        <span>H√≥a ƒë∆°n</span>
                    </div>
                    <i class="fas fa-chevron-right menu-arrow"></i>
                </div>
                <div class="menu-submenu">
                    <a href="#" class="submenu-item" data-tab="invoice-list">
                        <i class="fas fa-circle"></i>
                        <span>Danh s√°ch h√≥a ƒë∆°n</span>
                    </a>
                    <a href="#" class="submenu-item" data-tab="invoice-pending">
                        <i class="fas fa-circle"></i>
                        <span>Ch·ªù thanh to√°n</span>
                    </a>
                    <a href="#" class="submenu-item" data-tab="invoice-paid">
                        <i class="fas fa-circle"></i>
                        <span>ƒê√£ thanh to√°n</span>
                    </a>
                </div>
            </div>

            <!-- Nh√† cung c·∫•p -->
            <div class="menu-group">
                <div class="menu-group-header" data-section="suppliers">
                    <div class="menu-header-content">
                        <i class="fas fa-truck"></i>
                        <span>Nh√† cung c·∫•p</span>
                    </div>
                    <i class="fas fa-chevron-right menu-arrow"></i>
                </div>
                <div class="menu-submenu">
                    <a href="#" class="submenu-item" data-tab="supplier-list">
                        <i class="fas fa-circle"></i>
                        <span>Danh s√°ch NCC</span>
                    </a>
                    <a href="#" class="submenu-item" data-tab="supplier-orders">
                        <i class="fas fa-circle"></i>
                        <span>ƒê∆°n ƒë·∫∑t h√†ng</span>
                    </a>
                </div>
            </div>

            @if (userRole == "Admin")
            {
                <!-- Nh√¢n vi√™n (ch·ªâ Admin) -->
                <div class="menu-group">
                    <div class="menu-group-header" data-section="employees">
                        <div class="menu-header-content">
                            <i class="fas fa-users"></i>
                            <span>Nh√¢n vi√™n</span>
                        </div>
                        <i class="fas fa-chevron-right menu-arrow"></i>
                    </div>
                    <div class="menu-submenu">
                        <a href="#" class="submenu-item" data-tab="employee-list">
                            <i class="fas fa-circle"></i>
                            <span>Danh s√°ch nh√¢n vi√™n</span>
                        </a>
                        <a href="#" class="submenu-item" data-tab="employee-add">
                            <i class="fas fa-circle"></i>
                            <span>Th√™m nh√¢n vi√™n</span>
                        </a>
                        <a href="#" class="submenu-item" data-tab="employee-roles">
                            <i class="fas fa-circle"></i>
                            <span>Ph√¢n quy·ªÅn</span>
                        </a>
                    </div>
                </div>

                <!-- B√°o c√°o -->
                <div class="menu-group">
                    <div class="menu-group-header" data-section="reports">
                        <div class="menu-header-content">
                            <i class="fas fa-chart-bar"></i>
                            <span>B√°o c√°o</span>
                        </div>
                        <i class="fas fa-chevron-right menu-arrow"></i>
                    </div>
                    <div class="menu-submenu">
                        <a href="#" class="submenu-item" data-tab="report-revenue">
                            <i class="fas fa-circle"></i>
                            <span>B√°o c√°o doanh thu</span>
                        </a>
                        <a href="#" class="submenu-item" data-tab="report-inventory">
                            <i class="fas fa-circle"></i>
                            <span>B√°o c√°o t·ªìn kho</span>
                        </a>
                        <a href="#" class="submenu-item" data-tab="report-usage">
                            <i class="fas fa-circle"></i>
                            <span>Th·ªëng k√™ s·ª≠ d·ª•ng</span>
                        </a>
                    </div>
                </div>
            }

            <!-- C√†i ƒë·∫∑t -->
            <div class="menu-group">
                <div class="menu-group-header" data-section="settings">
                    <div class="menu-header-content">
                        <i class="fas fa-cog"></i>
                        <span>C√†i ƒë·∫∑t</span>
                    </div>
                    <i class="fas fa-chevron-right menu-arrow"></i>
                </div>
                <div class="menu-submenu">
                    <a href="#" class="submenu-item" data-tab="settings-general">
                        <i class="fas fa-circle"></i>
                        <span>C√†i ƒë·∫∑t chung</span>
                    </a>
                    <a href="#" class="submenu-item" data-tab="settings-profile">
                        <i class="fas fa-circle"></i>
                        <span>H·ªì s∆° c√° nh√¢n</span>
                    </a>
                </div>
            </div>
        </nav>
    </aside>

    <!-- Main Content -->
    <main class="dashboard-content">
        <!-- Dashboard Section (Default) -->
        <div id="dashboard" class="content-section active">
            <h2>ƒêang t·∫£i...</h2>
        </div>

        <!-- Medicine Management Section -->
        <div id="medicines" class="content-section">
            <div class="medicine-container">
                <div class="page-header">
                    <h2 style="margin: 0; font-size: 1.8rem; font-weight: 700;">Qu·∫£n l√Ω thu·ªëc</h2>
                    <p style="margin: 5px 0 0 0; opacity: 0.9; font-size: 0.95rem;">Qu·∫£n l√Ω th√¥ng tin thu·ªëc trong h·ªá th·ªëng</p>
                </div>
                <div id="medicineContent">
                    <p style="text-align: center; padding: 50px; color: #6c757d;">Ch·ªçn m·ªôt m·ª•c t·ª´ menu b√™n tr√°i</p>
                </div>
            </div>
        </div>

        <!-- B·ªánh nh√¢n Section -->
        <div id="patients" class="content-section">
            <div id="patientContent">
                <div class="text-center py-5">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">ƒêang t·∫£i...</span>
                    </div>
                    <p class="mt-3 text-muted">ƒêang t·∫£i danh s√°ch b·ªánh nh√¢n...</p>
                </div>
            </div>
        </div>

        <!-- Warehouse Section - PH·∫¶N N√ÄY QUAN TR·ªåNG -->
        <div id="warehouse" class="content-section">
            <div id="warehouseContent">
                <p style="text-align: center; padding: 50px; color: #6c757d;">
                    <i class="fas fa-warehouse" style="font-size: 3rem; opacity: 0.3; display: block; margin-bottom: 15px;"></i>
                    ƒêang t·∫£i d·ªØ li·ªáu kho...
                </p>
            </div>
        </div>
    </main>
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="~/js/BenhNhan/BenhNhan.js"></script>
    <script>
        // ==================== PANEL MANAGEMENT SYSTEM ====================
        let panelStack = [];
        let currentPanelLevel = 0;

        // M·ªü panel m·ªõi
        function openPanel(url, title, icon = 'fas fa-file') {
            currentPanelLevel++;

            const panelId = 'panel-' + currentPanelLevel;
            const overlayId = 'overlay-' + currentPanelLevel;

            // T·∫°o overlay
            const overlay = $('<div>', {
                id: overlayId,
                class: 'panel-overlay',
                'data-level': currentPanelLevel
            });

            // T·∫°o panel container
            const panel = $('<div>', {
                id: panelId,
                class: 'panel-container',
                'data-level': currentPanelLevel
            });

            // T·∫°o panel header
            const header = $(`
                <div class="panel-header">
                    <h4 class="panel-title">
                        <i class="${icon}"></i>
                        <span>${title}</span>
                    </h4>
                    <button class="panel-close-btn" onclick="closePanel(${currentPanelLevel})">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `);

            // T·∫°o panel body
            const body = $('<div>', {
                class: 'panel-body'
            }).html('<div style="text-align: center; padding: 50px;"><div class="spinner"></div></div>');

            panel.append(header).append(body);

            // Th√™m v√†o DOM
            $('body').append(overlay).append(panel);

            // ƒê√≥ng panel khi click overlay
            overlay.on('click', function () {
                closePanel(currentPanelLevel);
            });

            // Hi·ªÉn th·ªã panel v·ªõi animation
            setTimeout(() => {
                overlay.addClass('show');
                panel.addClass('show');
            }, 10);

            // Load n·ªôi dung
            $.ajax({
                url: url,
                method: 'GET',
                headers: {
                    'X-Requested-With': 'XMLHttpRequest'
                },
                success: function (data) {
                    body.html(data);
                },
                error: function (xhr, status, error) {
                    body.html(`<div class="alert alert-danger">L·ªói khi t·∫£i n·ªôi dung: ${error}</div>`);
                }
            });

            // Th√™m v√†o stack
            panelStack.push({
                id: panelId,
                overlayId: overlayId,
                level: currentPanelLevel
            });

            return currentPanelLevel;
        }

        // ƒê√≥ng panel
        function closePanel(level) {
            const panelData = panelStack.find(p => p.level === level);

            if (!panelData) return;

            const panel = $('#' + panelData.id);
            const overlay = $('#' + panelData.overlayId);

            // ·∫®n v·ªõi animation
            panel.removeClass('show');
            overlay.removeClass('show');

            // X√≥a kh·ªèi DOM sau animation
            setTimeout(() => {
                panel.remove();
                overlay.remove();
            }, 400);

            // X√≥a kh·ªèi stack
            panelStack = panelStack.filter(p => p.level !== level);

            // C·∫≠p nh·∫≠t current level
            if (panelStack.length > 0) {
                currentPanelLevel = Math.max(...panelStack.map(p => p.level));
            } else {
                currentPanelLevel = 0;
            }
        }

        // ƒê√≥ng t·∫•t c·∫£ panel
        function closeAllPanels() {
            while (panelStack.length > 0) {
                closePanel(panelStack[panelStack.length - 1].level);
            }
        }

        // ==================== GLOBAL FUNCTIONS FOR VIEWS ====================

         // H√†m load Details trong panel
         function loadThuocDetailsPanel(maThuoc) {
             openPanel(`/Thuoc/Details/${maThuoc}`, 'Chi ti·∫øt thu·ªëc', 'fas fa-pills');
         }

         // H√†m load Edit trong panel
         function loadThuocEditPanel(maThuoc) {
             openPanel(`/Thuoc/Edit/${maThuoc}`, 'Ch·ªânh s·ª≠a thu·ªëc', 'fas fa-edit');
         }

         // --- C√ÅC H√ÄM CHO QU·∫¢N L√ù KHO (S·ª¨A T·∫†I ƒê√ÇY) ---

         // H√†m m·ªü Phi·∫øu Nh·∫≠p trong panel
         function openPhieuNhapPanel() {
             // G·ªçi h√†m openPanel ƒë√£ c√≥ s·∫µn c·ªßa b·∫°n, tr·ªè t·ªõi ƒë√∫ng Controller/Action
             openPanel('/PhieuNhap/Create', 'T·∫°o phi·∫øu nh·∫≠p kho', 'fas fa-file-import');
         }

         // H√†m m·ªü Phi·∫øu Xu·∫•t (Phi·∫øu C·∫•p) trong panel
         function openPhieuXuatPanel() {
             // Tr·ªè t·ªõi Controller PhieuCap
             openPanel('/PhieuCap/Create', 'T·∫°o phi·∫øu xu·∫•t kho', 'fas fa-file-export');
         }

         // H√†m xem chi ti·∫øt Kho trong panel (n·∫øu c·∫ßn)
         function viewWarehouse(maKho) {
             openPanel(`/Kho/Details/${maKho}`, 'Chi ti·∫øt kho', 'fas fa-warehouse');
         }

         // H√†m s·ª≠a Kho trong panel (n·∫øu c·∫ßn)
         function editWarehouse(maKho) {
             openPanel(`/Kho/Edit/${maKho}`, 'Ch·ªânh s·ª≠a kho', 'fas fa-edit');
         }

        // H√†m t∆∞∆°ng th√≠ch ng∆∞·ª£c - redirect sang panel
        function loadThuocContent(url) {
            // N·∫øu l√† Details ho·∫∑c Edit, m·ªü trong panel
            if (url.includes('/Details/')) {
                const maThuoc = url.split('/Details/')[1];
                loadThuocDetailsPanel(maThuoc);
            } else if (url.includes('/Edit/')) {
                const maThuoc = url.split('/Edit/')[1];
                loadThuocEditPanel(maThuoc);
            } else if (url.includes('/PhieuNhap/')) {
                loadPhieuNhapPanel();
            } else {
                // C√°c trang kh√°c load b√¨nh th∆∞·ªùng
                showLoading();
                showSection('medicines');

                $.ajax({
                    url: url,
                    method: 'GET',
                    headers: {
                        'X-Requested-With': 'XMLHttpRequest'
                    },
                    success: function (data) {
                        $('#medicineContent').html(data);
                        hideLoading();
                    },
                    error: function (xhr, status, error) {
                        console.error('Error loading content:', error);
                        $('#medicineContent').html('<div class="alert alert-danger">L·ªói khi t·∫£i n·ªôi dung: ' + error + '</div>');
                        hideLoading();
                    }
                });
            }
        }

        // ==================== WAREHOUSE CONTENT LOADER ====================
        // H√†m load ri√™ng cho n·ªôi dung Kho - ƒê√É S·ª¨A
        function loadWarehouseContent(url) {
            console.log('üîµ Loading warehouse from:', url); // Debug log

            showLoading();
            showSection('warehouse'); // Chuy·ªÉn sang section warehouse

            $.ajax({
                url: url,
                method: 'GET',
                headers: {
                    'X-Requested-With': 'XMLHttpRequest'
                },
                success: function (data) {
                    console.log('‚úÖ Warehouse data loaded successfully'); // Debug log
                    $('#warehouseContent').html(data);
                    hideLoading();
                },
                error: function (xhr, status, error) {
                    console.error('‚ùå Error loading warehouse:', error);
                    console.error('Status:', status);
                    console.error('Response:', xhr.responseText);

                    $('#warehouseContent').html(
                        '<div class="alert alert-danger" style="margin: 20px;">' +
                        '<h4><i class="fas fa-exclamation-triangle"></i> L·ªói t·∫£i d·ªØ li·ªáu kho</h4>' +
                        '<p><strong>Chi ti·∫øt l·ªói:</strong> ' + error + '</p>' +
                        '<p><strong>Status:</strong> ' + status + '</p>' +
                        '<p><strong>URL:</strong> ' + url + '</p>' +
                        '<button class="btn btn-primary" onclick="loadWarehouseContent(\'' + url + '\')">Th·ª≠ l·∫°i</button>' +
                        '</div>'
                    );
                    hideLoading();
                }
            });
        }

        // ==================== PATIENT CONTENT LOADER ====================
        function loadPatientContent(url) {
            console.log('üîµ Loading patient from:', url);

            showLoading();
            showSection('patients');

            $.ajax({
                url: url,
                method: 'GET',
                headers: {
                    'X-Requested-With': 'XMLHttpRequest'
                },
                success: function (data) {
                    console.log('‚úÖ Patient data loaded successfully');
                    $('#patientContent').html(data);
                    hideLoading();
                },
                error: function (xhr, status, error) {
                    console.error('‚ùå Error loading patient:', error);
                    $('#patientContent').html(
                        '<div class="alert alert-danger" style="margin: 20px;">L·ªói t·∫£i d·ªØ li·ªáu b·ªánh nh√¢n: ' + error + '</div>'
                    );
                    hideLoading();
                }
            });
        }

        // ==================== MENU & NAVIGATION ====================
        $(document).ready(function () {
            // Load dashboard khi trang ƒë∆∞·ª£c t·∫£i
            loadDashboard();

            // Menu accordion functionality
            $('.menu-group-header').click(function () {
                const $header = $(this);
                const $group = $header.parent();
                const $submenu = $group.find('.menu-submenu');
                const section = $header.data('section');

                // Toggle submenu n·∫øu c√≥
                if ($submenu.length > 0) {
                    // Close other submenus
                    $('.menu-submenu').not($submenu).removeClass('show');
                    $('.menu-group-header').not($header).removeClass('active');

                    // Toggle current submenu
                    $submenu.toggleClass('show');
                    $header.toggleClass('active');
                } else {
                    // If no submenu, it's a direct link (like Dashboard)
                    $('.menu-group-header').removeClass('active');
                    $('.submenu-item').removeClass('active');
                    $header.addClass('active');

                    // Show corresponding section
                    if (section === 'dashboard') {
                        loadDashboard();
                    }
                }
            });

            // Submenu item click - ƒê√É S·ª¨A
            $('.submenu-item').click(function (e) {
                e.preventDefault();

                const $item = $(this);
                const url = $item.attr('data-url'); // D√πng .attr() kh√¥ng ph·∫£i .data()

                console.log('üìå Menu clicked, URL:', url); // Debug log

                // Update active states
                $('.submenu-item').removeClass('active');
                $item.addClass('active');

                // Ensure parent section is active
                const $header = $item.closest('.menu-group').find('.menu-group-header');
                $('.menu-group-header').removeClass('active');
                $header.addClass('active');

                // Load content based on URL
                if (url) {
                    if (url.includes('/BenhNhan/')) {
                        loadPatientContent(url);
                    } else if (url.includes('/Thuoc/')) {
                        loadThuocContent(url);
                    } else if (url.includes('/Kho/')) {
                        // Load warehouse content
                        loadWarehouseContent(url);
                    } else {
                        // Default load
                        loadThuocContent(url);
                    }
                } else {
                    console.warn('‚ö†Ô∏è No URL found for this menu item');
                }
            });

            // ƒê√≥ng panel khi nh·∫•n ESC
            $(document).keydown(function (e) {
                if (e.key === 'Escape' && panelStack.length > 0) {
                    closePanel(panelStack[panelStack.length - 1].level);
                }
            });
        });

        // Helper function to show section
        function showSection(sectionId) {
            console.log('üîÑ Switching to section:', sectionId); // Debug log
            $('.content-section').removeClass('active');
            $('#' + sectionId).addClass('active');
        }

        // Load Dashboard
        function loadDashboard() {
            showLoading();
            showSection('dashboard');
            closeAllPanels(); // ƒê√≥ng t·∫•t c·∫£ panels khi chuy·ªÉn v·ªÅ dashboard

            $.ajax({
                url: '/Admin/Dashboard',
                method: 'GET',
                headers: {
                    'X-Requested-With': 'XMLHttpRequest'
                },
                success: function (data) {
                    $('#dashboard').html(data);
                    hideLoading();

                    // Re-initialize charts after loading dashboard
                    setTimeout(initializeCharts, 100);
                },
                error: function (xhr, status, error) {
                    console.error('Error loading dashboard:', error);
                    $('#dashboard').html('<div class="alert alert-danger">L·ªói khi t·∫£i dashboard</div>');
                    hideLoading();
                }
            });
        }

        // Loading functions
        function showLoading() {
            $('#loadingOverlay').addClass('show');
        }

        function hideLoading() {
            $('#loadingOverlay').removeClass('show');
        }

        // Chart initialization
        function initializeCharts() {
            console.log('Charts initialized');
        }
    </script>
}
