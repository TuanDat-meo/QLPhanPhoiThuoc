@{
    ViewData["Title"] = "Trang quản trị";
    Layout = "~/Views/Shared/_Layout.cshtml";
    var chucVu = ViewBag.ChucVu ?? "Quản trị viên";
    var tenNhanVien = ViewBag.TenNhanVien ?? "Admin";
    var maNhanVien = ViewBag.MaNhanVien ?? "";
    var userRole = User.FindFirst(System.Security.Claims.ClaimTypes.Role)?.Value ?? "Admin";
}

<style>
    /* ==================== MODERN COMPACT SIDEBAR LAYOUT ==================== */
    
    .admin-container {
        display: flex;
        gap: 25px;
        min-height: calc(100vh - 200px);
        padding: 20px;
    }

    /* ==================== COMPACT SIDEBAR ==================== */
    .sidebar {
        width: 260px;
        background: white;
        border-radius: 12px;
        box-shadow: 0 2px 12px rgba(0,0,0,0.08);
        padding: 0;
        height: fit-content;
        max-height: calc(100vh - 140px);
        overflow-y: auto;
        position: sticky;
        top: 90px;
    }

    .sidebar::-webkit-scrollbar {
        width: 5px;
    }

    .sidebar::-webkit-scrollbar-track {
        background: #f1f1f1;
    }

    .sidebar::-webkit-scrollbar-thumb {
        background: #1e3a5f;
        border-radius: 10px;
    }

    .sidebar-header {
        padding: 20px;
        border-bottom: 1px solid #e9ecef;
        background: linear-gradient(135deg, #1e3a5f 0%, #0f2847 100%);
        border-radius: 12px 12px 0 0;
        color: white;
    }

    .sidebar-title {
        font-size: 1.1rem;
        font-weight: 700;
        margin: 0;
    }

    .sidebar-subtitle {
        font-size: 0.85rem;
        opacity: 0.9;
        margin-top: 3px;
    }

    /* Menu Accordion */
    .menu-accordion {
        padding: 10px 0;
    }

    .menu-group {
        margin-bottom: 5px;
    }

    .menu-group-header {
        padding: 12px 20px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: space-between;
        transition: all 0.3s ease;
        border-left: 3px solid transparent;
        color: #495057;
        font-weight: 500;
        user-select: none;
    }

    .menu-group-header:hover {
        background: #f8f9fa;
        color: #1e3a5f;
        border-left-color: #1e3a5f;
    }

    .menu-group-header.active {
        background: linear-gradient(90deg, rgba(30,58,95,0.1) 0%, transparent 100%);
        color: #1e3a5f;
        border-left-color: #1e3a5f;
        font-weight: 600;
    }

    .menu-header-content {
        display: flex;
        align-items: center;
        gap: 12px;
        flex: 1;
    }

    .menu-header-content i {
        width: 22px;
        text-align: center;
        font-size: 1.1rem;
    }

    .menu-arrow {
        transition: transform 0.3s ease;
        font-size: 0.85rem;
        color: #6c757d;
    }

    .menu-group-header.active .menu-arrow {
        transform: rotate(90deg);
        color: #1e3a5f;
    }

    /* Submenu */
    .menu-submenu {
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.3s ease;
        background: #f8f9fa;
    }

    .menu-submenu.show {
        max-height: 500px;
    }

    .submenu-item {
        padding: 10px 20px 10px 54px;
        color: #6c757d;
        text-decoration: none;
        display: flex;
        align-items: center;
        gap: 10px;
        transition: all 0.2s ease;
        border-left: 3px solid transparent;
        font-size: 0.9rem;
        cursor: pointer;
    }

    .submenu-item:hover {
        background: white;
        color: #1e3a5f;
        border-left-color: #38bdf8;
        text-decoration: none;
        padding-left: 58px;
    }

    .submenu-item.active {
        background: white;
        color: #1e3a5f;
        border-left-color: #1e3a5f;
        font-weight: 600;
    }

    .submenu-item i {
        font-size: 0.75rem;
        width: 12px;
    }

    .menu-badge {
        background: linear-gradient(135deg, #f5576c 0%, #f093fb 100%);
        color: white;
        font-size: 0.7rem;
        padding: 2px 8px;
        border-radius: 12px;
        font-weight: 600;
        margin-left: auto;
    }

    /* ==================== MAIN CONTENT AREA ==================== */
    .dashboard-content {
        flex: 1;
        min-width: 0;
    }

    /* Content Section */
    .content-section {
        display: none;
    }

    .content-section.active {
        display: block;
        animation: fadeIn 0.3s ease;
    }

    @@keyframes fadeIn {
        from {
            opacity: 0;
            transform: translateY(10px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    /* Loading Spinner */
    .loading-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(255, 255, 255, 0.9);
        z-index: 9999;
        justify-content: center;
        align-items: center;
    }

    .loading-overlay.show {
        display: flex;
    }

    .spinner {
        border: 4px solid #f3f3f3;
        border-top: 4px solid #1e3a5f;
        border-radius: 50%;
        width: 50px;
        height: 50px;
        animation: spin 1s linear infinite;
    }

    @@keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    /* CSS từ Index.cshtml cho phần quản lý thuốc */
    .medicine-container {
        padding: 25px;
        background: #f8f9fa;
        min-height: calc(100vh - 200px);
    }

    .page-header {
        background: linear-gradient(135deg, #1e3a5f 0%, #0f2847 100%);
        color: white;
        padding: 25px 30px;
        border-radius: 12px;
        margin-bottom: 25px;
        box-shadow: 0 4px 15px rgba(30, 58, 95, 0.3);
    }

    .filter-card {
        background: white;
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 20px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }

    .filter-row {
        display: flex;
        gap: 15px;
        flex-wrap: wrap;
        align-items: end;
    }

    .filter-group {
        flex: 1;
        min-width: 200px;
    }

    .filter-group label {
        display: block;
        margin-bottom: 5px;
        font-weight: 600;
        color: #495057;
        font-size: 0.9rem;
    }

    .filter-group input,
    .filter-group select {
        width: 100%;
        padding: 10px 15px;
        border: 1px solid #dee2e6;
        border-radius: 8px;
        font-size: 0.95rem;
        transition: all 0.3s;
    }

    .btn-filter {
        background: #1e3a5f;
        color: white;
        border: none;
        padding: 10px 25px;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.3s;
    }

    .btn-filter:hover {
        background: #0f2847;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(30, 58, 95, 0.3);
    }

    .btn-reset {
        background: #6c757d;
        color: white;
        border: none;
        padding: 10px 25px;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.3s;
    }

    .action-bar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
    }

    .btn-add {
        background: linear-gradient(135deg, #38ef7d 0%, #11998e 100%);
        color: white;
        border: none;
        padding: 12px 30px;
        border-radius: 8px;
        font-weight: 600;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        transition: all 0.3s;
        box-shadow: 0 4px 12px rgba(56, 239, 125, 0.3);
    }

    .btn-add:hover {
        transform: translateY(-2px);
        color: white;
        text-decoration: none;
    }

    .medicine-table-card {
        background: white;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }

    .medicine-table {
        width: 100%;
        margin: 0;
    }

    .medicine-table thead {
        background: linear-gradient(135deg, #1e3a5f 0%, #0f2847 100%);
        color: white;
    }

    .medicine-table thead th {
        padding: 15px;
        font-weight: 600;
        text-align: left;
        white-space: nowrap;
        border: none;
    }

    .medicine-table tbody tr {
        border-bottom: 1px solid #e9ecef;
        transition: all 0.2s;
    }

    .medicine-table tbody tr:hover {
        background: #f8f9fa;
    }

    .medicine-table tbody td {
        padding: 15px;
        vertical-align: middle;
    }

    .sortable {
        cursor: pointer;
        user-select: none;
        position: relative;
        padding-right: 25px !important;
    }

    .sortable::after {
        content: '⇅';
        position: absolute;
        right: 10px;
        opacity: 0.5;
    }

    .sortable.sorted-asc::after {
        content: '↑';
        opacity: 1;
    }

    .sortable.sorted-desc::after {
        content: '↓';
        opacity: 1;
    }

    .badge {
        padding: 5px 12px;
        border-radius: 20px;
        font-size: 0.85rem;
        font-weight: 600;
    }

    .badge-success {
        background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        color: white;
    }

    .badge-danger {
        background: linear-gradient(135deg, #f5576c 0%, #f093fb 100%);
        color: white;
    }

    .btn-action {
        display: inline-block;
        padding: 6px 10px;
        margin: 0 2px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        transition: all 0.2s;
        text-decoration: none;
    }

    .btn-view {
        background: linear-gradient(135deg, #38bdf8 0%, #7dd3fc 100%);
        color: white;
    }

    .btn-edit {
        background: linear-gradient(135deg, #f59e0b 0%, #fbbf24 100%);
        color: white;
    }

    .pagination-container {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px 20px;
        border-top: 1px solid #e9ecef;
    }

    .pagination {
        display: flex;
        gap: 5px;
    }

    .pagination a,
    .pagination span {
        padding: 8px 12px;
        border-radius: 6px;
        text-decoration: none;
        color: #495057;
        transition: all 0.2s;
    }

    .pagination a:hover {
        background: #1e3a5f;
        color: white;
    }

    .pagination span.active {
        background: #1e3a5f;
        color: white;
        font-weight: 600;
    }
</style>

<!-- Loading Overlay -->
<div class="loading-overlay" id="loadingOverlay">
    <div class="spinner"></div>
</div>

<!-- Main Container -->
<div class="admin-container">
    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <div class="sidebar-title">Menu quản trị</div>
            <div class="sidebar-subtitle">@tenNhanVien</div>
        </div>

        <div class="menu-accordion">
            <!-- Tổng quan -->
            <div class="menu-group">
                <div class="menu-group-header active" data-section="dashboard" onclick="loadDashboard()">
                    <div class="menu-header-content">
                        <i class="fas fa-tachometer-alt"></i>
                        <span>Tổng quan</span>
                    </div>
                </div>
            </div>

            <!-- Quản lý thuốc -->
            <div class="menu-group">
                <div class="menu-group-header" data-section="medicines">
                    <div class="menu-header-content">
                        <i class="fas fa-pills"></i>
                        <span>Quản lý thuốc</span>
                    </div>
                    <i class="fas fa-chevron-right menu-arrow"></i>
                </div>
                <div class="menu-submenu">
                    <a class="submenu-item" data-url="/Admin/Thuoc/Index" onclick="loadThuocContent(this.dataset.url); return false;">
                        <i class="fas fa-circle"></i>
                        <span>Danh sách thuốc</span>
                    </a>
                    <a class="submenu-item" data-url="/Admin/Thuoc/TonKho" onclick="loadThuocContent(this.dataset.url); return false;">
                        <i class="fas fa-circle"></i>
                        <span>Tồn kho</span>
                    </a>
                    <a class="submenu-item" data-url="/Admin/Thuoc/ThongKe" onclick="loadThuocContent(this.dataset.url); return false;">
                        <i class="fas fa-circle"></i>
                        <span>Thống kê</span>
                    </a>
                    <a class="submenu-item" data-url="/Admin/Thuoc/CanhBao" onclick="loadThuocContent(this.dataset.url); return false;">
                        <i class="fas fa-circle"></i>
                        <span>Cảnh báo</span>
                    </a>
                </div>
            </div>
            <div class="menu-group">
                <div class="menu-group-header" data-section="prescriptions">
                    <div class="menu-header-content">
                        <i class="fas fa-prescription"></i>
                        <span>Đơn thuốc</span>
                    </div>
                    <i class="fas fa-chevron-right menu-arrow"></i>
                </div>
                <div class="menu-submenu">
                    <a href="#" class="submenu-item" data-tab="prescription-list">
                        <i class="fas fa-circle"></i>
                        <span>Danh sách đơn thuốc</span>
                    </a>
                    <a href="#" class="submenu-item" data-tab="prescription-create">
                        <i class="fas fa-circle"></i>
                        <span>Tạo đơn thuốc mới</span>
                    </a>
                    <a href="#" class="submenu-item" data-tab="prescription-history">
                        <i class="fas fa-circle"></i>
                        <span>Lịch sử kê đơn</span>
                    </a>
                </div>
            </div>

            <!-- Hóa đơn -->
            <div class="menu-group">
                <div class="menu-group-header" data-section="invoices">
                    <div class="menu-header-content">
                        <i class="fas fa-file-invoice-dollar"></i>
                        <span>Hóa đơn</span>
                    </div>
                    <i class="fas fa-chevron-right menu-arrow"></i>
                </div>
                <div class="menu-submenu">
                    <a href="#" class="submenu-item" data-tab="invoice-list">
                        <i class="fas fa-circle"></i>
                        <span>Danh sách hóa đơn</span>
                    </a>
                    <a href="#" class="submenu-item" data-tab="invoice-pending">
                        <i class="fas fa-circle"></i>
                        <span>Chờ thanh toán</span>
                    </a>
                    <a href="#" class="submenu-item" data-tab="invoice-paid">
                        <i class="fas fa-circle"></i>
                        <span>Đã thanh toán</span>
                    </a>
                </div>
            </div>

            <!-- Nhà cung cấp -->
            <div class="menu-group">
                <div class="menu-group-header" data-section="suppliers">
                    <div class="menu-header-content">
                        <i class="fas fa-truck"></i>
                        <span>Nhà cung cấp</span>
                    </div>
                    <i class="fas fa-chevron-right menu-arrow"></i>
                </div>
                <div class="menu-submenu">
                    <a href="#" class="submenu-item" data-tab="supplier-list">
                        <i class="fas fa-circle"></i>
                        <span>Danh sách NCC</span>
                    </a>
                    <a href="#" class="submenu-item" data-tab="supplier-orders">
                        <i class="fas fa-circle"></i>
                        <span>Đơn đặt hàng</span>
                    </a>
                </div>
            </div>

            @if (userRole == "Admin")
            {
                <!-- Nhân viên (chỉ Admin) -->
                <div class="menu-group">
                    <div class="menu-group-header" data-section="employees">
                        <div class="menu-header-content">
                            <i class="fas fa-users"></i>
                            <span>Nhân viên</span>
                        </div>
                        <i class="fas fa-chevron-right menu-arrow"></i>
                    </div>
                    <div class="menu-submenu">
                        <a href="#" class="submenu-item" data-tab="employee-list">
                            <i class="fas fa-circle"></i>
                            <span>Danh sách nhân viên</span>
                        </a>
                        <a href="#" class="submenu-item" data-tab="employee-add">
                            <i class="fas fa-circle"></i>
                            <span>Thêm nhân viên</span>
                        </a>
                        <a href="#" class="submenu-item" data-tab="employee-roles">
                            <i class="fas fa-circle"></i>
                            <span>Phân quyền</span>
                        </a>
                    </div>
                </div>

                <!-- Báo cáo -->
                <div class="menu-group">
                    <div class="menu-group-header" data-section="reports">
                        <div class="menu-header-content">
                            <i class="fas fa-chart-bar"></i>
                            <span>Báo cáo</span>
                        </div>
                        <i class="fas fa-chevron-right menu-arrow"></i>
                    </div>
                    <div class="menu-submenu">
                        <a href="#" class="submenu-item" data-tab="report-revenue">
                            <i class="fas fa-circle"></i>
                            <span>Báo cáo doanh thu</span>
                        </a>
                        <a href="#" class="submenu-item" data-tab="report-inventory">
                            <i class="fas fa-circle"></i>
                            <span>Báo cáo tồn kho</span>
                        </a>
                        <a href="#" class="submenu-item" data-tab="report-usage">
                            <i class="fas fa-circle"></i>
                            <span>Thống kê sử dụng</span>
                        </a>
                    </div>
                </div>
            }

            <!-- Cài đặt -->
            <div class="menu-group">
                <div class="menu-group-header" data-section="settings">
                    <div class="menu-header-content">
                        <i class="fas fa-cog"></i>
                        <span>Cài đặt</span>
                    </div>
                    <i class="fas fa-chevron-right menu-arrow"></i>
                </div>
                <div class="menu-submenu">
                    <a href="#" class="submenu-item" data-tab="settings-general">
                        <i class="fas fa-circle"></i>
                        <span>Cài đặt chung</span>
                    </a>
                    <a href="#" class="submenu-item" data-tab="settings-profile">
                        <i class="fas fa-circle"></i>
                        <span>Hồ sơ cá nhân</span>
                    </a>
                </div>
            </div>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="dashboard-content">
        <!-- Dashboard Section (Default) -->
        <div id="dashboard" class="content-section active">
            <h2>Đang tải...</h2>
        </div>

        <!-- Medicine Management Section -->
        <div id="medicines" class="content-section">
            <div class="medicine-container">
                <div class="page-header">
                    <h2 style="margin: 0; font-size: 1.8rem; font-weight: 700;">Quản lý thuốc</h2>
                    <p style="margin: 5px 0 0 0; opacity: 0.9; font-size: 0.95rem;">Quản lý thông tin thuốc trong hệ thống</p>
                </div>
                <div id="medicineContent">
                    <p style="text-align: center; padding: 50px; color: #6c757d;">Chọn một mục từ menu bên trái</p>
                </div>
            </div>
        </div>
    </main>
</div>

@section Scripts {
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    $(document).ready(function() {
        // Load dashboard khi trang được tải
        loadDashboard();

        // Menu accordion functionality
        $('.menu-group-header').click(function() {
            const $header = $(this);
            const $group = $header.parent();
            const $submenu = $group.find('.menu-submenu');
            const section = $header.data('section');

            // Toggle submenu nếu có
            if ($submenu.length > 0) {
                // Close other submenus
                $('.menu-submenu').not($submenu).removeClass('show');
                $('.menu-group-header').not($header).removeClass('active');
                
                // Toggle current submenu
                $submenu.toggleClass('show');
                $header.toggleClass('active');
            } else {
                // If no submenu, it's a direct link (like Dashboard)
                $('.menu-group-header').removeClass('active');
                $('.submenu-item').removeClass('active');
                $header.addClass('active');
                
                // Show corresponding section
                if (section) {
                    showSection(section);
                }
            }
        });

        // Submenu item click
        $('.submenu-item').click(function(e) {
            e.preventDefault();
            
            const $item = $(this);
            
            // Update active states
            $('.submenu-item').removeClass('active');
            $item.addClass('active');
            
            // Ensure parent section is active
            const $header = $item.closest('.menu-group').find('.menu-group-header');
            $('.menu-group-header').removeClass('active');
            $header.addClass('active');
        });
    });

    // Helper function to show section
    function showSection(sectionId) {
        $('.content-section').removeClass('active');
        $('#' + sectionId).addClass('active');
    }

    // Load Dashboard
    function loadDashboard() {
        showLoading();
        showSection('dashboard');
        
        $.ajax({
            url: '/Admin/Dashboard',
            method: 'GET',
            headers: {
                'X-Requested-With': 'XMLHttpRequest'
            },
            success: function(data) {
                $('#dashboard').html(data);
                hideLoading();
                
                // Re-initialize charts after loading dashboard
                setTimeout(initializeCharts, 100);
            },
            error: function(xhr, status, error) {
                console.error('Error loading dashboard:', error);
                $('#dashboard').html('<div class="alert alert-danger">Lỗi khi tải dashboard</div>');
                hideLoading();
            }
        });
    }

    // Load Thuoc Content (Index, TonKho, ThongKe, CanhBao)
    function loadThuocContent(url) {
        showLoading();
        showSection('medicines');
        
        $.ajax({
            url: url,
            method: 'GET',
            headers: {
                'X-Requested-With': 'XMLHttpRequest'
            },
            success: function(data) {
                $('#medicineContent').html(data);
                hideLoading();
            },
            error: function(xhr, status, error) {
                console.error('Error loading content:', error);
                $('#medicineContent').html('<div class="alert alert-danger">Lỗi khi tải nội dung</div>');
                hideLoading();
            }
        });
    }

    // Loading functions
    function showLoading() {
        $('#loadingOverlay').addClass('show');
    }

    function hideLoading() {
        $('#loadingOverlay').removeClass('show');
    }

    // Chart initialization (sẽ được gọi sau khi dashboard được load)
    function initializeCharts() {
        // Charts sẽ được khởi tạo trong partial view _Dashboard.cshtml
        console.log('Charts initialized');
    }
</script>
}
