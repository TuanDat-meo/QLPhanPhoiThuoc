@model QLPhanPhoiThuoc.Models.Entities.DonThuoc

<div class="modal-body p-0">
    <div class="p-4 bg-light border-bottom">
        <div class="row">
            <div class="col-md-6 border-end">
                <h6 class="text-uppercase text-muted small fw-bold mb-3">Thông tin bệnh nhân</h6>
                <div class="mb-1"><strong>Họ tên:</strong> <span class="text-primary text-uppercase">@Model.BenhNhan?.TenBenhNhan</span></div>
                <div class="mb-1"><strong>Mã BN:</strong> @Model.MaBenhNhan</div>
                <div class="mb-1"><strong>Chẩn đoán:</strong> <span class="text-danger">@(Model.ChanDoanSoBo ?? "Chưa có dữ liệu")</span></div>
            </div>
            <div class="col-md-6 ps-4">
                <h6 class="text-uppercase text-muted small fw-bold mb-3">Thông tin đơn thuốc</h6>
                <div class="mb-1"><strong>Ngày kê:</strong> @Model.NgayKeDon.ToString("dd/MM/yyyy HH:mm")</div>
                <div class="mb-1"><strong>Bác sĩ:</strong> @(Model.NhanVien?.TenNhanVien ?? Model.MaNhanVien)</div>
                <div class="mb-1"><strong>Loại đơn:</strong> <span class="badge @(Model.LoaiDon == "BHYT" ? "bg-primary" : "bg-info text-dark")">@Model.LoaiDon</span></div>
            </div>
        </div>
    </div>

    <div class="p-4">
        <h6 class="text-uppercase text-muted small fw-bold mb-3"><i class="fas fa-pills me-2"></i>Danh mục thuốc kê đơn</h6>
        <div class="table-responsive border rounded shadow-sm">
            <table class="table table-hover mb-0">
                <thead class="bg-primary text-white">
                    <tr>
                        <th class="ps-3">Tên thuốc / Hàm lượng</th>
                        <th class="text-center">Số lượng</th>
                        <th>Hướng dẫn sử dụng</th>
                    </tr>
                </thead>
                <tbody>
                    @if (Model.ChiTietDonThuocs != null && Model.ChiTietDonThuocs.Any())
                    {
                        @foreach (var ct in Model.ChiTietDonThuocs)
                        {
                                    <tr>
                                        <td class="ps-3">
                                            <div class="fw-bold">@(ct.Thuoc?.TenThuoc ?? ct.MaThuoc)</div>
                                            <div class="small text-muted">Mã thuốc: @ct.MaThuoc</div>
                                        </td>
                                        <td class="text-center align-middle">
                                            <span class="badge bg-danger rounded-pill px-3 py-2 fs-6">@ct.SoLuong</span>
                                            <div class="small text-muted mt-1">Dùng trong @ct.SoNgayDung ngày</div>
                                        </td>
                                        <td class="align-middle">
                                            <div class="fw-bold text-dark">@ct.LieuDung</div>
                                            <div class="small text-muted italic">@ct.CachDung</div>
                                    @if (!string.IsNullOrEmpty(ct.GhiChu))
                                    {
                                                    <div class="text-warning small mt-1"><i class="fas fa-exclamation-circle me-1"></i>@ct.GhiChu</div>
                                    }
                                        </td>
                                    </tr>
                        }
                    }
                    else
                    {
                            <tr>
                                <td colspan="3" class="text-center py-4 text-muted fst-italic">Không có dữ liệu thuốc cho đơn này.</td>
                            </tr>
                    }
                </tbody>
            </table>
        </div>

        @if (!string.IsNullOrEmpty(Model.GhiChuBacSi))
        {
                <div class="mt-4 p-3 border-start border-3 border-info bg-light">
                    <strong><i class="fas fa-comment-medical me-2"></i>Lời dặn của bác sĩ:</strong>
                    <p class="mb-0 mt-1">@Model.GhiChuBacSi</p>
                </div>
        }
    </div>
</div>

<div class="modal-footer bg-light d-flex justify-content-between">
    <div class="fs-5 fw-bold">Tổng tiền đơn: <span class="text-success">@Model.TongTien.ToString("N0") ₫</span></div>
    <div>
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
        @if (Model.TrangThai == "ChuaCapPhat")
        {
                <button type="button" class="btn btn-primary" onclick="alert('Tính năng cấp thuốc sẽ triển khai sau')">
                    <i class="fas fa-check-circle me-1"></i>Xác nhận cấp phát
                </button>
        }
    </div>
</div>