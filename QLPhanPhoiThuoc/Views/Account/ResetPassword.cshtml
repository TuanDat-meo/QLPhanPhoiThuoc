@model QLPhanPhoiThuoc.Models.ViewModels.ResetPasswordViewModel
@{
    ViewData["Title"] = "Đặt lại mật khẩu";
    Layout = null;
}

<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - Quản lý thuốc bệnh viện</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * { margin:0; padding:0; box-sizing:border-box; }

        body {
            font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;
            background:linear-gradient(135deg,#0f172a 0%,#1e293b 50%,#0f172a 100%);
            min-height:100vh;
            display:flex; align-items:center; justify-content:center;
            padding:20px;
            position:relative; overflow:hidden;
        }
        body::before {
            content:''; position:fixed; top:-30%; left:-15%;
            width:600px; height:600px;
            background:radial-gradient(circle,rgba(56,189,248,.08) 0%,transparent 70%);
            border-radius:50%; pointer-events:none;
        }
        body::after {
            content:''; position:fixed; bottom:-25%; right:-10%;
            width:500px; height:500px;
            background:radial-gradient(circle,rgba(251,113,133,.07) 0%,transparent 70%);
            border-radius:50%; pointer-events:none;
        }

        /* ─── Card ─── */
        .reset-container {
            background:#fff;
            border-radius:24px;
            box-shadow:0 25px 60px rgba(0,0,0,.35);
            overflow:hidden;
            max-width:480px;
            width:100%;
            position:relative; z-index:1;
        }

        /* ─── Header ─── */
        .reset-header {
            background:linear-gradient(160deg,#1e3a5f 0%,#0f2847 50%,#162d4a 100%);
            padding:44px 40px 36px;
            text-align:center;
            color:#fff;
            position:relative; overflow:hidden;
        }
        .reset-header::before {
            content:''; position:absolute; top:-60%; right:-40%;
            width:70%; height:70%;
            background:radial-gradient(circle,rgba(56,189,248,.12) 0%,transparent 70%);
            border-radius:50%;
        }
        .reset-header > * { position:relative; z-index:1; }

        .reset-icon {
            width:78px; height:78px;
            background:rgba(167,139,250,.15);
            border-radius:22px;
            display:flex; align-items:center; justify-content:center;
            margin:0 auto 20px;
            font-size:2.2rem; color:#a78bfa;
            box-shadow:0 4px 16px rgba(167,139,250,.25);
        }
        .reset-header h1 { font-size:1.75rem; font-weight:700; margin-bottom:8px; }
        .reset-header p { font-size:.93rem; opacity:.8; color:#cbd5e1; }

        /* ─── Body ─── */
        .reset-body { padding:36px 40px 32px; background:#fafbfc; }

        .info-box {
            background:#faf5ff;
            border-left:4px solid #a78bfa;
            padding:14px 16px;
            border-radius:10px;
            margin-bottom:26px;
        }
        .info-box p {
            margin:0; color:#6b21a8; font-size:.88rem; line-height:1.6;
            display:flex; align-items:flex-start; gap:10px;
        }
        .info-box p i { color:#a78bfa; margin-top:2px; flex-shrink:0; }

        /* ─── Form ─── */
        .form-group { margin-bottom:22px; }
        .form-label {
            display:block; margin-bottom:7px; color:#1e293b;
            font-weight:600; font-size:.88rem; letter-spacing:.2px;
        }

        .input-wrapper { position:relative; }
        .input-wrapper .icon-left {
            position:absolute; left:15px; top:50%;
            transform:translateY(-50%); color:#94a3b8;
            font-size:1rem; pointer-events:none; z-index:2;
        }
        .input-wrapper .toggle-pw {
            position:absolute; right:14px; top:50%;
            transform:translateY(-50%); color:#94a3b8;
            font-size:1rem; cursor:pointer; z-index:2;
            background:none; border:none; padding:5px;
            border-radius:7px; transition:color .2s, background .2s;
            display:flex; align-items:center; justify-content:center;
        }
        .input-wrapper .toggle-pw:hover { color:#1e3a5f; background:rgba(30,58,95,.07); }

        .form-control {
            width:100%; padding:13px 44px 13px 44px;
            border:2px solid #e2e8f0; border-radius:12px;
            font-size:.95rem; color:#0f172a; background:#fff;
            transition:border-color .25s, box-shadow .25s;
        }
        .form-control:focus {
            outline:none; border-color:#38bdf8;
            box-shadow:0 0 0 3px rgba(56,189,248,.18);
        }
        .form-control::placeholder { color:#94a3b8; }

        .text-danger { color:#fb7185; font-size:.82rem; margin-top:5px; display:block; }

        /* ─── Strength meter ─── */
        .password-strength { margin-top:10px; }
        .strength-meter {
            height:5px; background:#e2e8f0; border-radius:5px;
            overflow:hidden; margin-bottom:6px;
        }
        .strength-meter-fill { height:100%; width:0%; transition:all .3s ease; border-radius:5px; }
        .strength-meter-fill.weak  { width:33%; background:#fb7185; }
        .strength-meter-fill.medium { width:66%; background:#fbbf24; }
        .strength-meter-fill.strong { width:100%; background:#4ade80; }
        .strength-text { font-size:.8rem; font-weight:600; }

        /* ─── Password requirements ─── */
        .password-requirements {
            background:#f1f5f9;
            border-radius:10px;
            padding:14px 16px;
            margin-top:12px;
            border:1px solid #e2e8f0;
        }
        .password-requirements h6 {
            font-size:.84rem; font-weight:700;
            margin-bottom:10px; color:#1e293b;
            display:flex; align-items:center; gap:6px;
        }
        .password-requirements h6 i { color:#a78bfa; }

        .requirement {
            font-size:.82rem; color:#64748b; margin-bottom:6px;
            display:flex; align-items:center; gap:8px;
            transition:color .25s;
        }
        .requirement i { font-size:.7rem; color:#cbd5e1; transition:color .25s; }
        .requirement.met { color:#16a34a; }
        .requirement.met i { color:#4ade80; }

        /* ─── Button ─── */
        .btn-primary {
            width:100%; padding:14px;
            background:linear-gradient(135deg,#1e3a5f 0%,#162d4a 100%);
            border:none; border-radius:12px; color:#fff;
            font-size:1rem; font-weight:600; cursor:pointer;
            transition:transform .2s, box-shadow .2s;
            text-transform:uppercase; letter-spacing:.8px;
            display:flex; align-items:center; justify-content:center; gap:10px;
        }
        .btn-primary:hover { transform:translateY(-2px); box-shadow:0 8px 24px rgba(30,58,95,.35); }
        .btn-primary:active { transform:translateY(0); }

        /* ─── Alerts ─── */
        .alert { padding:12px 16px; border-radius:10px; margin-bottom:18px; font-size:.88rem; display:flex; align-items:center; gap:10px; }
        .alert-danger { background:#fff1f2; color:#e11d48; border:1px solid #fecdd3; }

        /* ─── Responsive ─── */
        media (max-width:576px) {
            .reset-body { padding:28px 24px; }
            .reset-header { padding:32px 24px 28px; }
            .reset-header h1 { font-size:1.5rem; }
        }
    </style>
</head>
<body>
    <div class="reset-container">
        <!-- Header -->
        <div class="reset-header">
            <div class="reset-icon">
                <i class="fas fa-lock"></i>
            </div>
            <h1>Đặt lại mật khẩu</h1>
            <p>Tạo mật khẩu mới cho tài khoản của bạn</p>
        </div>

        <!-- Body -->
        <div class="reset-body">
            <div class="info-box">
                <p>
                    <i class="fas fa-shield-alt"></i>
                    Mật khẩu mới phải có ít nhất 6 ký tự và bao gồm chữ cái, số để đảm bảo an toàn.
                </p>
            </div>

            <form method="post" asp-action="ResetPassword" asp-controller="Account" id="resetForm">
                <input type="hidden" asp-for="Token" />
                <input type="hidden" asp-for="Email" />

                <div asp-validation-summary="ModelOnly" class="alert alert-danger"></div>

                <!-- New Password -->
                <div class="form-group">
                    <label asp-for="NewPassword" class="form-label">Mật khẩu mới</label>
                    <div class="input-wrapper">
                        <i class="fas fa-lock icon-left"></i>
                        <input asp-for="NewPassword" type="password" class="form-control"
                               placeholder="Nhập mật khẩu mới (tối thiểu 6 ký tự)" id="newPassword" />
                        <button type="button" class="toggle-pw" onclick="togglePw('newPassword',this)" aria-label="Hiện/Ẩn mật khẩu">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                    <span asp-validation-for="NewPassword" class="text-danger"></span>

                    <div class="password-strength" id="passwordStrength" style="display:none;">
                        <div class="strength-meter">
                            <div class="strength-meter-fill" id="strengthMeter"></div>
                        </div>
                        <div class="strength-text" id="strengthText"></div>
                    </div>

                    <div class="password-requirements">
                        <h6><i class="fas fa-shield-alt"></i> Yêu cầu mật khẩu:</h6>
                        <div class="requirement" id="req-length">
                            <i class="fas fa-circle"></i><span>Tối thiểu 6 ký tự</span>
                        </div>
                        <div class="requirement" id="req-letter">
                            <i class="fas fa-circle"></i><span>Có ít nhất một chữ cái</span>
                        </div>
                        <div class="requirement" id="req-number">
                            <i class="fas fa-circle"></i><span>Có ít nhất một chữ số</span>
                        </div>
                    </div>
                </div>

                <!-- Confirm Password -->
                <div class="form-group">
                    <label asp-for="ConfirmPassword" class="form-label">Xác nhận mật khẩu</label>
                    <div class="input-wrapper">
                        <i class="fas fa-lock icon-left"></i>
                        <input asp-for="ConfirmPassword" type="password" class="form-control"
                               placeholder="Nhập lại mật khẩu mới" id="confirmPassword" />
                        <button type="button" class="toggle-pw" onclick="togglePw('confirmPassword',this)" aria-label="Hiện/Ẩn mật khẩu">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                    <span asp-validation-for="ConfirmPassword" class="text-danger"></span>
                </div>

                <button type="submit" class="btn-primary">
                    <i class="fas fa-check"></i>
                    Đặt lại mật khẩu
                </button>
            </form>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        /* ─── Eye toggle ─── */
        function togglePw(id, btn) {
            const inp = document.getElementById(id);
            const ic  = btn.querySelector('i');
            if (inp.type === 'password') {
                inp.type = 'text';
                ic.classList.replace('fa-eye','fa-eye-slash');
            } else {
                inp.type = 'password';
                ic.classList.replace('fa-eye-slash','fa-eye');
            }
        }

        /* ─── Strength meter ─── */
        const newPassword      = document.getElementById('newPassword');
        const strengthMeter    = document.getElementById('strengthMeter');
        const strengthText     = document.getElementById('strengthText');
        const passwordStrength = document.getElementById('passwordStrength');

        newPassword.addEventListener('input', function() {
            const pw = this.value;

            if (pw.length > 0) {
                passwordStrength.style.display = 'block';

                const hasLength = pw.length >= 6;
                const hasLetter = /[a-zA-Z]/.test(pw);
                const hasNumber = /[0-9]/.test(pw);

                setReq('req-length', hasLength);
                setReq('req-letter', hasLetter);
                setReq('req-number', hasNumber);

                let s = (hasLength?1:0) + (hasLetter?1:0) + (hasNumber?1:0);

                strengthMeter.className = 'strength-meter-fill';
                if (s === 1) {
                    strengthMeter.classList.add('weak');
                    strengthText.textContent = 'Yếu';
                    strengthText.style.color = '#fb7185';
                } else if (s === 2) {
                    strengthMeter.classList.add('medium');
                    strengthText.textContent = 'Trung bình';
                    strengthText.style.color = '#fbbf24';
                } else if (s === 3) {
                    strengthMeter.classList.add('strong');
                    strengthText.textContent = 'Mạnh';
                    strengthText.style.color = '#4ade80';
                }
            } else {
                passwordStrength.style.display = 'none';
                ['req-length','req-letter','req-number'].forEach(id => document.getElementById(id).classList.remove('met'));
            }
        });

        function setReq(id, met) {
            document.getElementById(id).classList.toggle('met', met);
        }
    </script>
    @section Scripts {
        @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
    }
</body>
</html>
